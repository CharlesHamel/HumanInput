(function(){"use strict";var e=function(e){var a=navigator.getGamepads(),t;for(t=0;t<a.length;t++){if(a[t]&&a[t].index==e){return true}}},a=function(a){var t=this;t.__name__="GamepadPlugin";t.exports={};t.gamepads=[];t._gamepadTimer=null;t.gamepadUpdate=function(){var s,n,p,d,r,i,o,g,l,m={type:"gamepad",target:a.elem},u=a.filter(m),f=navigator.getGamepads();for(s=0;s<t.gamepads.length;s++){if(t.gamepads[s]&&!e(s)){a.trigger("gpad:disconnected",t.gamepads[s]);t.gamepads[s]=null}}for(s=0;s<f.length;++s){if(f[s]){p=f[s].index,r=t.gamepads[p];if(!r){t.log.debug("Gamepad "+p+" detected:",f[s]);a.trigger("gpad:connected",f[s]);t.gamepads[p]={axes:[],buttons:[],timestamp:f[s].timestamp,id:f[s].id};r=t.gamepads[p];for(n=0;n<f[s].buttons.length;n++){r.buttons[n]={value:0,pressed:false}}for(n=0;n<f[s].axes.length;n++){r.axes[n]=0}continue}else{if(r.timestamp==f[s].timestamp){continue}d=JSON.parse(JSON.stringify(r));r.timestamp=f[s].timestamp;r.axes=f[s].axes.slice(0);for(n=0;n<d.buttons.length;n++){r.buttons[n].pressed=f[s].buttons[n].pressed;r.buttons[n].value=f[s].buttons[n].value}}if(u){for(n=0;n<r.buttons.length;n++){i="up";if(r.buttons[n].pressed){i="down"}o="gpad:button:"+n;if(i=="down"){if(!a.isDown(o)){a._addDown(o)}}else{if(a.isDown(o)){a._handleSeqEvents();a._removeDown(o)}}if(r.buttons[n].pressed!=d.buttons[n].pressed){a.trigger(a.scope+o,r.buttons[n].value,f[s]);a.trigger(a.scope+"gpad:button:"+i,r.buttons[n].value,f[s]);a.trigger(a.scope+o+":"+i,r.buttons[n].value,f[s]);g=true}else if(r.buttons[n].value!=d.buttons[n].value){a.trigger(a.scope+o,r.buttons[n].value,f[s])}}for(n=0;n<d.axes.length;n++){if(r.axes[n]!=d.axes[n]){o="gpad:axis:"+n;a.trigger(a.scope+o,r.axes[n],f[s])}}if(g){a._handleDownEvents(f[s])}}}}};t.loadController=function(e){for(var t in e){a.aliases[t]=e[t]}};return t};a.prototype.init=function(e){var a=this;a.stopGamepadUpdates=function(){clearInterval(a._gamepadTimer)};a.startGamepadUpdates=function(){clearInterval(a._gamepadTimer);if(a.gamepads.length){a._gamepadTimer=setInterval(a.gamepadUpdate,e.settings.gpadInterval)}else{a._gamepadTimer=setInterval(a.gamepadUpdate,e.settings.gpadCheckInterval)}};a.log=new e.logger(e.settings.logLevel||"INFO","[HI Gamepad]");a.log.debug(e.l("Initializing Gamepad Plugin"),a);e.settings.gpadInterval=e.settings.gpadInterval||100;e.settings.gpadCheckInterval=e.settings.gpadCheckInterval||3e3;clearInterval(a._gamepadTimer);if(e.settings.listenEvents.indexOf("gamepad")!=-1){a.gamepadUpdate();a.startGamepadUpdates();e.on("document:hidden",a.stopGamepadUpdates);e.on("document:visibile",a.startGamepadUpdates);e.on("gpad:connected",a.startGamepadUpdates)}a.exports.gamepads=a.gamepads;a.exports._gamepadTimer=a._gamepadTimer;a.exports.gamepadUpdate=a.gamepadUpdate;a.exports.loadController=a.loadController;a.exports.stopGamepadUpdates=a.stopGamepadUpdates;a.exports.startGamepadUpdates=a.startGamepadUpdates;return a};HumanInput.plugins.push(a)}).call(this);
