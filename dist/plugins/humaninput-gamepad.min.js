(function(){"use strict";var e=function(e){var t=this;t.__name__="GamepadPlugin";t.exports={};t.gamepads=[];t._gamepadTimer=null;t.gamepadUpdate=function(){var a,n,s,i,r,d,g,o,p={type:"gamepad",target:e.elem},l=navigator.getGamepads();for(a=0;a<l.length;++a){if(l[a]){s=l[a].index,r=t.gamepads[s];if(!r){t.log.debug("Gamepad "+s+" detected:",l[a]);e.trigger("gpad:connected",l[a]);t.gamepads[s]={axes:[],buttons:[],timestamp:l[a].timestamp,id:l[a].id};r=t.gamepads[s];for(n=0;n<l[a].buttons.length;n++){r.buttons[n]={value:0,pressed:false}}for(n=0;n<l[a].axes.length;n++){r.axes[n]=0}continue}else{if(r.timestamp==l[a].timestamp){continue}i=JSON.parse(JSON.stringify(r));r.timestamp=l[a].timestamp;r.axes=l[a].axes.slice(0);for(n=0;n<i.buttons.length;n++){r.buttons[n].pressed=l[a].buttons[n].pressed;r.buttons[n].value=l[a].buttons[n].value}}for(n=0;n<r.buttons.length;n++){d="up";if(r.buttons[n].pressed){d="down"}g="gpad:button:"+n;if(d=="down"){if(!e.isDown(g)){e._addDown(g)}}else{if(e.isDown(g)){e._handleSeqEvents();e._removeDown(g)}}if(r.buttons[n].pressed!=i.buttons[n].pressed){e.trigger(e.scope+g+":"+d,r.buttons[n].value,l[a]);o=true}if(r.buttons[n].value!=i.buttons[n].value){e.trigger(e.scope+g+":value",r.buttons[n].value,l[a])}}if(e.filter(p)){for(n=0;n<i.axes.length;n++){if(r.axes[n]!=i.axes[n]){g="gpad:axis:"+n;e.trigger(e.scope+g,r.axes[n],l[a])}}if(o){e._handleDownEvents(l[a])}}}}};t.loadController=function(t){for(var a in t){e.aliases[a]=t[a]}};return t};e.prototype.init=function(e){var t=this,a=function(){clearInterval(t._gamepadTimer)},n=function(){clearInterval(t._gamepadTimer);if(t.gamepads.length){t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadInterval)}else{t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadCheckInterval)}};t.log=new e.logger(e.settings.logLevel||"INFO","[HI Gamepad]");t.log.debug(e.l("Initializing Gamepad Plugin"),t);e.settings.gpadInterval=e.settings.gpadInterval||100;e.settings.gpadCheckInterval=e.settings.gpadCheckInterval||3e3;clearInterval(t._gamepadTimer);if(e.settings.listenEvents.indexOf("gamepad")!=-1){t.gamepadUpdate();n();e.on("document:hidden",a);e.on("document:visibile",n)}t.exports.gamepads=t.gamepads;t.exports._gamepadTimer=t._gamepadTimer;t.exports.gamepadUpdate=t.gamepadUpdate;t.exports.loadController=t.loadController;return t};HumanInput.plugins.push(e)}).call(this);
