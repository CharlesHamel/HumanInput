(function(){"use strict";var e=this;if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var i=this.toString();if(typeof t!=="number"||!isFinite(t)||Math.floor(t)!==t||t>i.length){t=i.length}t-=e.length;var o=i.indexOf(e,t);return o!==-1&&o===t}}HumanInput.defaultListenEvents.push("idle");var t=function(e){var t=this;t.HI=e;t.__name__="IdlePlugin";t.exports={};return t},i=function(e){if(isNaN(e)){var t=parseInt(e.slice(0,-1));if(e.endsWith("s")){return t*1e3}else if(e.endsWith("m")){return t*1e3*60}else if(e.endsWith("h")){return t*1e3*60*60}else if(e.endsWith("d")){return t*1e3*60*60*24}else if(e.endsWith("M")){return t*1e3*60*60*24*30}else if(e.endsWith("y")){return t*1e3*60*60*24*365}else{return parseInt(e)}}else{return e}};t.prototype.init=function(t){var o=this,n,s;o.log=new t.logger(t.settings.logLevel||"INFO","[HI Idle]");o.log.debug(t.l("Initializing Idle Plugin"),o);o.lastActivity=new Date;o.timeout=null;t.settings.autostartIdle=t.settings.autostartIdle||true;n=t.settings.idleTimeout||"5m";o.idleTimeout=i(n);s=t.settings.idleCheckInterval||"5s";o.idleCheckInterval=i(s);o.mouseMoveCheck=function(){clearTimeout(o.mouseMoveTimeout);o.lastActivity=new Date;e.removeEventListener("mousemove",o.mouseMoveCheck,true);e.removeEventListener("mousemove",o.resetTimeout,true);o.mouseMoveTimeout=setTimeout(function(){e.addEventListener("mousemove",o.mouseMoveCheck,true)},o.idleCheckInterval)};o.resetTimeout=function(){o.log.debug(t.l("Activity detected; resetting idle timeout"));o.mouseMoveCheck();clearTimeout(o.timeout);o.timeout=setTimeout(o.idleCheck,o.idleCheckInterval)};o.startIdleChecker=function(){t.on(["click","keydown","scroll"],o.resetTimeout);o.resetTimeout();t.on("idle",function(){o.stopIdleChecker();t.once(["click","keydown","scroll"],o.resetTimeout);e.addEventListener("mousemove",o.resetTimeout,true)});t.once("hi:reset",o.stopIdleChecker)};o.stopIdleChecker=function(){e.removeEventListener("mousemove",o.mouseMoveCheck,true);t.off(["click","keydown","scroll"],o.resetTimeout);clearTimeout(o.timeout);clearTimeout(o.mouseMoveTimeout)};o.idleCheck=function(){clearTimeout(o.timeout);if(Date.now()-o.lastActivity.getTime()>o.idleTimeout){o.HI.trigger("idle",o.lastActivity)}else{o.timeout=setTimeout(o.idleCheck,o.idleCheckInterval)}};if(t.settings.listenEvents.indexOf("idle")!=-1){if(t.settings.autostartIdle){o.startIdleChecker()}}o.exports.startIdleChecker=o.startIdleChecker;o.exports.stopIdleChecker=o.stopIdleChecker;return o};HumanInput.plugins.push(t)}).call(this);
