(function(){"use strict";var e=this;if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var i=this.toString();if(typeof t!=="number"||!isFinite(t)||Math.floor(t)!==t||t>i.length){t=i.length}t-=e.length;var n=i.indexOf(e,t);return n!==-1&&n===t}}HumanInput.defaultListenEvents.push("idle");var t=function(e){var t=this;t.HI=e;t.__name__="IdlePlugin";t.exports={};return t},i=function(e){if(isNaN(e)){var t=parseInt(e.slice(0,-1));if(e.endsWith("s")){return t*1e3}else if(e.endsWith("m")){return t*1e3*60}else if(e.endsWith("h")){return t*1e3*60*60}else if(e.endsWith("d")){return t*1e3*60*60*24}else if(e.endsWith("M")){return t*1e3*60*60*24*30}else if(e.endsWith("y")){return t*1e3*60*60*24*365}else{return parseInt(e)}}else{return e}};t.prototype.init=function(t){var n=this,o,s;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Idle]");n.log.debug(t.l("Initializing Idle Plugin"),n);n.lastActivity=new Date;n.timeout=null;t.settings.autostartIdle=t.settings.autostartIdle||true;o=t.settings.idleTimeout||"5m";n.idleTimeout=i(o);s=t.settings.idleCheckInterval||"5s";n.idleCheckInterval=i(s);n.mouseMoveCheck=function(){clearTimeout(n.mouseMoveTimeout);n.lastActivity=new Date;e.removeEventListener("mousemove",n.mouseMoveCheck,true);e.removeEventListener("mousemove",n.resetTimeout,true);n.mouseMoveTimeout=setTimeout(function(){e.addEventListener("mousemove",n.mouseMoveCheck,true)},n.idleCheckInterval)};n.resetTimeout=function(){n.log.debug(t.l("Activity detected; resetting idle timeout"));n.mouseMoveCheck();clearTimeout(n.timeout);n.timeout=setTimeout(n.idleCheck,n.idleCheckInterval)};n.startIdleChecker=function(){t.on(["click","keydown","scroll"],n.resetTimeout);n.resetTimeout();t.on("idle",function(){n.stopIdleChecker();t.once(["click","keydown","scroll"],n.resetTimeout);e.addEventListener("mousemove",n.resetTimeout,true)});t.once("hi:reset",n.stopIdleChecker)};n.stopIdleChecker=function(){e.removeEventListener("mousemove",n.mouseMoveCheck,true);t.off(["click","keydown","scroll"],n.resetTimeout);clearTimeout(n.timeout);clearTimeout(n.mouseMoveTimeout)};n.idleCheck=function(){var e=(new Date).getTime();clearTimeout(n.timeout);if(e-n.lastActivity.getTime()>n.idleTimeout){n.HI.trigger("idle",n.lastActivity)}else{n.timeout=setTimeout(n.idleCheck,n.HI.settings.idleCheckInterval)}};if(t.settings.listenEvents.indexOf("idle")!=-1){if(t.settings.autostartIdle){n.startIdleChecker()}}n.exports.startIdleChecker=n.startIdleChecker;n.exports.stopIdleChecker=n.stopIdleChecker;return n};HumanInput.plugins.push(t)}).call(this);
