(function(){"use strict";HumanInput.defaultListenEvents.push("speech");var e=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition;var t=function(e){var t=this;t.__name__="SpeechRecPlugin";t.exports={};t._rtSpeech=[];t._rtSpeechPop=function(){t._rtSpeech.reverse();t._rtSpeech.pop();t._rtSpeech.reverse()};t._rtSpeechTimer=null;t.startSpeechRec=function(){t._recognition=new webkitSpeechRecognition;t.log.debug(e.l("Starting speech recognition"),t._recognition);t._recognition.lang=e.settings.speechLang||navigator.language||"en-US";t._recognition.continuous=true;t._recognition.interimResults=true;t._recognition.onresult=function(n){var o,i="speech",c;for(o=n.resultIndex;o<n.results.length;++o){c=n.results[o][0].transcript.trim();if(n.results[o].isFinal){e._addDown(i);e._handleDownEvents(n,c);e._removeDown(i);i+=':"'+c.replace(/-/g,"–")+'"';e._addDown(i);e._handleDownEvents(n,c);e._handleSeqEvents();e._removeDown(i)}else{i+=":rt";e._addDown(i);e._handleDownEvents(n,c);e._removeDown(i);i+=':"'+c.replace(/-/g,"–")+'"';if(t._rtSpeech.indexOf(i)==-1){t._rtSpeech.push(i);e._addDown(i);e._handleDownEvents(n,c);e._removeDown(i)}}}};t._started=true;t._recognition.start()};t.stopSpeechRec=function(){t.log.debug(e.l("Stopping speech recognition"));t._recognition.stop();t._started=false};return t};t.prototype.init=function(t){var n=this;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Speech]");n.log.debug(t.l("Initializing Speech Recognition Plugin"),n);t.settings.autostartSpeech=t.settings.autostartSpeech||false;if(t.settings.listenEvents.indexOf("speech")!=-1){if(e){if(t.settings.autostartSpeech){n.startSpeechRec()}t.on("document:hidden",function(){if(n._started){n.stopSpeechRec()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartSpeech){n.startSpeechRec()}})}else{n.startSpeechRec=t.noop;n.stopSpeechRec=t.noop}}n.exports.startSpeechRec=n.startSpeechRec;n.exports.stopSpeechRec=n.stopSpeechRec;return n};HumanInput.plugins.push(t)}).call(this);
