(function(){"use strict";var e=this,t=navigator.userAgent.indexOf("Mac OS X")!=-1,n=false,o=["keydown","keypress","keyup","click","dblclick","wheel","contextmenu","compositionstart","compositionupdate","compositionend","cut","copy","paste","select"],i=["pointerdown","pointerup"],r=["mousedown","mouseup","touchstart","touchend"],s=false,a=[],c,l=function(e){return e},f=Object.prototype.toString,u=function(e){var t="";if(e.name){t+=" "+e.name}else if(e.id){t+=" "+e.id}else if(e.nodeName){t+=" "+e.nodeName}return"[HI"+t+"]"},p=function(e){if(typeof e==="string"){var t=document.querySelector(e);return t}return e},d=function(e){if(w.isString(e)){e=[e]}return e},g=function(e,t){if(t.indexOf(false)!=-1){e.preventDefault()}},h=function(e){var t,n;if(w.isArray(e)){t=e.slice(0);for(n=0;n<t.length;n++){t[n]=h(t[n])}return t}else{return e}},m=function(e,t){var n=[],o,i,r;if(e.length==1){return e[0]}else{o=m(e.slice(1),t);for(i=0;i<o.length;i++){for(r=0;r<e[0].length;r++){n.push(e[0][r]+t+o[i])}}return n}},v=function(e,t){return/touch/.test(e.type)?(e.originalEvent||e).changedTouches[0]["page"+t]:e["page"+t]},_=function(e){if(e==e.toUpperCase()){return true}},S=function(e,t){return t!=null&&e!=null&&t.indexOf(e)==0},w=w||l;["Function","String","Number"].forEach(function(e){w["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}});w.isArray=Array.isArray;w.toArray=function(e){var t,n=[];for(t=e.length>>>0;t--;){n[t]=e[t]}return n};w.partial=function(e){var t=w.toArray(arguments);t.shift();return function(){return e.apply(this,t.concat(w.toArray(arguments)))}};if(Object.keys(KeyboardEvent.prototype).indexOf("key")!=-1){n=true}var y=function(t,o){if(!(this instanceof y)){return new y(t,o)}var i=this,r,f,E,b,O,x,C,k,L=0;i.__version__="1.0.7";i.OSKEYS=["OS","OSLeft","OSRight"],i.CONTROLKEYS=["Control","ControlLeft","ControlRight"],i.ALTKEYS=["Alt","AltLeft","AltRight"],i.SHIFTKEYS=["Shift","ShiftLeft","ShiftRight","⇧"],i.ALLMODIFIERS=i.OSKEYS.concat(i.CONTROLKEYS,i.ALTKEYS,i.SHIFTKEYS),i.MODIFIERPRIORITY={};i.ControlKeyEvent="ctrl";i.ShiftKeyEvent="shift";i.AltKeyEvent="alt";i.OSKeyEvent="os";i.AltAltNames=["option","⌥"];i.AltOSNames=["meta","win","⌘","cmd","command"];o=o||{};i.l=o.translate||l;o.listenEvents=o.listenEvents||y.defaultListenEvents;o.eventOptions=o.eventOptions||{};o.noKeyRepeat=o.noKeyRepeat||true;o.sequenceTimeout=o.sequenceTimeout||3e3;o.maxSequenceBuf=o.maxSequenceBuf||12;o.uniqueNumpad=o.uniqueNumpad||false;o.swipeThreshold=o.swipeThreshold||100;o.disableSequences=o.disableSequences||false;o.disableSelectors=o.disableSelectors||false;i.settings=o;i.elem=p(t||e);i.log=new i.logger(o.logLevel||"INFO",u(t));x=i.CONTROLKEYS.concat(["ctrl"]);C=i.ALTKEYS.concat(i.AltAltNames);k=i.OSKEYS.concat(i.AltOSNames);for(r=0;r<x.length;r++){i.MODIFIERPRIORITY[x[r].toLowerCase()]=5}for(r=0;r<i.SHIFTKEYS.length;r++){i.MODIFIERPRIORITY[i.SHIFTKEYS[r].toLowerCase()]=4}for(r=0;r<C.length;r++){i.MODIFIERPRIORITY[C[r].toLowerCase()]=3}for(r=0;r<k.length;r++){i.MODIFIERPRIORITY[k[r].toLowerCase()]=2}i._getInstanceName=function(){for(var t in e){if(e[t]===i)return t}};i._resetKeyStates=function(){i.modifiers={};i.seqBuffer=[];i.down=[];a=[];L=0;s=false};i._addDown=function(e,t){var n=i.down.indexOf(e);if(n==-1){n=a.indexOf(e)}if(n==-1&&t){n=a.indexOf(t)}if(n==-1){i.down.push(e);if(t){a.push(t)}else{a.push(e)}}};i._removeDown=function(e){var t=i.down.indexOf(e);if(t==-1){t=a.indexOf(e)}if(t==-1){t=a.indexOf(e.toUpperCase())}if(t!=-1){i.down.splice(t,1);a.splice(t,1)}L=i.down.length};i._doDownEvent=function(e){var t,n=w.toArray(arguments);n.shift();i._addDown(e);t=i._handleDownEvents.apply(i,n);i._handleSeqEvents();i._removeDown(e);return t};i._resetSeqTimeout=function(){clearTimeout(c);c=setTimeout(function(){i.log.debug(i.l("Resetting key states due to timeout"));i._resetKeyStates()},i.settings.sequenceTimeout)};i._genericEvent=function(e,t){var n=i.filter(t);if(n){if(e.type){t=e;e=null}if(e){e=e+":"}else{e=""}i.trigger(i.scope+e+t.type,t);if(t.target){i._handleSelectors(e+t.type,t)}}};i._handleSelectors=function(e){var t=[],n=w.toArray(arguments),o=i;n.shift();if(n[0]&&n[0].target){o=n[0].target;if(o.id){t=i.trigger.apply(o,[i.scope+e+":#"+o.id].concat(n))}if(o.classList&&o.classList.length){for(var r=0;r<o.classList.length;r++){t=t.concat(i.trigger.apply(o,[i.scope+e+":."+o.classList.item(r)].concat(n)))}}}return t};i._keyEvent=function(e){if(i.CONTROLKEYS.indexOf(e)!=-1){return i.ControlKeyEvent}else if(i.ALTKEYS.indexOf(e)!=-1){return i.AltKeyEvent}else if(i.SHIFTKEYS.indexOf(e)!=-1){return i.ShiftKeyEvent}else if(i.OSKEYS.indexOf(e)!=-1){return i.OSKeyEvent}else{return e.toLowerCase()}};i._seqCombinations=function(e,t){t=t||"-";var n=h(e),o=[],r=[],s,a;for(s=0;s<e.length;s++){o.push(n[s].join(t).toLowerCase())}o=[o.join(" ")];for(s=0;s<e.length;s++){for(a=0;a<e[s].length;a++){n[s][a]=[i._keyEvent(e[s][a])]}}for(s=0;s<n.length;s++){r.push(m(n[s],t))}r=r.join(" ");if(r!=o[0]){o.push(r)}return o};i._downEvents=function(){var e,t=[],n,o=-1,r,s=i.down.slice(0),c=a.slice(0);if(s.length){if(s.length>1){if(i.modifiers.shift){for(e=0;e<s.length;e++){o=s[e].indexOf("Shift");if(o!=-1){break}}}for(e=0;e<s.length;e++){if(s[e]!=a[e]&&o!=-1){r=true}}if(r){if(s.length==2){n=true}s.splice(o,1)}if(!n){t=t.concat(i._seqCombinations([s],"->"));if(r){t=t.concat(i._seqCombinations([c],"->"))}}}i._sortEvents(s);t=t.concat(i._seqCombinations([s]));if(r){i._sortEvents(c);t=t.concat(i._seqCombinations([c]))}}return t};i._handleDownEvents=function(){var e,t=[],n=[];t=i._downEvents();for(e=0;e<t.length;e++){n=n.concat(i.trigger.apply(i,[i.scope+t[e]].concat(w.toArray(arguments))));n=n.concat(i._handleSelectors.apply(i,[t[e]].concat(w.toArray(arguments))))}return n};i._handleSeqEvents=function(){var e,t,n,o=i.down.slice(0);if(L<o.length){o=i._sortEvents(o);i.seqBuffer.push(o);if(i.seqBuffer.length>i.settings.maxSequenceBuf){i.seqBuffer.shift()}if(i.seqBuffer.length>1){e=i._seqCombinations(i.seqBuffer);for(var t=0;t<e.length;t++){i._seqSlicer(e[t]).forEach(function(e){n=i.trigger(i.scope+e,i)})}if(n.length){i.seqBuffer=[]}}}i._resetSeqTimeout()};i._normSpecial=function(e,t,n){if(n.indexOf("Left")!=-1||n.indexOf("Right")!=-1){t=n}else if(i.settings.uniqueNumpad&&e==3){return"numpad"+t}if(S("arrow",t.toLowerCase())){t=t.substr(5)}return t};i._setModifiers=function(e,t){if(i.ALLMODIFIERS.indexOf(e)){if(i.SHIFTKEYS.indexOf(e)!=-1){i.modifiers.shift=t}if(i.CONTROLKEYS.indexOf(e)!=-1){i.modifiers.ctrl=t}if(i.ALTKEYS.indexOf(e)!=-1){i.modifiers.alt=t;i.modifiers.option=t;i.modifiers["⌥"]=t}if(i.OSKEYS.indexOf(e)!=-1){i.modifiers.meta=t;i.modifiers.command=t;i.modifiers.os=t;i.modifiers["⌘"]=t}i.modifiers[e]=t}};i._keydown=function(e){var t=[],o=e.which||e.keyCode,r=e.location||0,s=i.keyMaps[r][o]||i.keyMaps[0][o]||e.code,c=e.key||s,l=i.filter(e);c=i._normSpecial(r,c,s);i._setModifiers(c,true);if(c=="Compose"){i.state.composing=true;return}if(a.indexOf(c)==-1){i._addDown(c,s)}i._resetSeqTimeout();if(l){if(e.repeat&&i.settings.noKeyRepeat){e.preventDefault();return false}t=i.trigger(i.scope+"keydown",e,c,s);t=t.concat(i._handleSelectors("keydown",e));g(e,t);if(i.down.length>5){t=t.concat(i.trigger(i.scope+"faceplant",e))}t=t.concat(i.trigger(i.scope+"keydown:"+c.toLowerCase(),e,c,s));t=t.concat(i._handleSelectors("keydown:"+c.toLowerCase(),e));if(n){t=t.concat(i._handleDownEvents(e))}g(e,t)}};i._keypress=function(e){var t=e.charCode||e.which;var o=e.key||String.fromCharCode(t);if(!n&&t>47&&o.length){i.down.pop();i.down.push(o)}};i._keyup=function(e){var t,o=e.which||e.keyCode,r=e.location||0,s=i.keyMaps[r][o]||i.keyMaps[0][o]||e.code,c=e.key||s,l=i.filter(e);c=i._normSpecial(r,c,s);if(!a.length){return}if(i.state.composing){i.state.composing=false;return}if(l){if(!n){i._handleDownEvents(e)}t=i.trigger(i.scope+"keyup",e,c,s);t=t.concat(i._handleSelectors("keyup",e));t=t.concat(i.trigger(i.scope+"keyup:"+c.toLowerCase(),e));t=t.concat(i._handleSelectors("keyup:"+c.toLowerCase(),e));i._handleSeqEvents();g(e,t)}i._removeDown(c);i._setModifiers(s,false)};i._pointerdown=function(e){var t,n,o=i.mouse(e),r=[],s=e.changedTouches,a=e.pointerType,c="pointer",l=":down",u=i.filter(e);if(e.type=="mousedown"&&O){return}if(a){if(a=="touch"){n=e.pointerId;if(!i.touches[n]){i.touches[n]=e}}}else if(s&&s.length){for(t=0;t<s.length;t++){n=s[t].identifier;if(!i.touches[n]){i.touches[n]=s[t]}}}f=v(e,"X");E=v(e,"Y");i._resetSeqTimeout();if(u){r=i.trigger(i.scope+c+l,e);r=r.concat(i._handleSelectors(c+l,e));if(o.buttonName!==undefined){c+=":"+o.buttonName;r=r.concat(i.trigger(i.scope+c+l,e));r=r.concat(i._handleSelectors(c+l,e))}g(e,r)}i._addDown(c);i._handleDownEvents(e)};i._mousedown=i._pointerdown;i._touchstart=i._pointerdown;i._pointerup=function(e){var t,n,o,r,s,a,c,l=e.changedTouches,u=e.pointerType,p=i.settings.swipeThreshold,d=[],h=":up",m="pointer";if(u){if(u=="touch"){n=e.pointerId;if(i.touches[n]){f=i.touches[n].pageX;E=i.touches[n].pageY;s=e.pageX-f;a=e.pageY-E;delete i.touches[n]}}}else if(l){if(l.length){for(t=0;t<l.length;t++){n=l[t].identifier;if(i.touches[n]){f=i.touches[n].pageX;E=i.touches[n].pageY;s=e.pageX-f;a=e.pageY-E;delete i.touches[n]}}}if(Math.abs(e.pageX-f)<20&&Math.abs(e.pageY-E)<20){O=true}if(e.pageX==f&&e.pageY==E){r=true}}if(O&&e.type=="mouseup"){O=false;return}i._resetSeqTimeout();if(i.filter(e)){d=i.trigger(i.scope+m+h,e);o=i.mouse(e);if(o.buttonName!==undefined){m+=":"+o.buttonName;d=d.concat(i.trigger(i.scope+m+h,e));d=d.concat(i._handleSelectors(m+h,e))}s=f-v(e,"X");a=E-v(e,"Y");c="swipe";if(Math.abs(s)>Math.abs(a)){if(s>p){c+=":left"}else if(s<-p){c+=":right"}}else{if(a>p){c+=":up"}else if(a<-p){c+=":down"}}if(c!="swipe"){i._removeDown(m);i._addDown(c);d=d.concat(i._handleDownEvents(e));d=d.concat(i._handleSelectors(c,e));i._handleSeqEvents();i._removeDown(c)}else{i._handleSeqEvents();i._removeDown(m);if(r){d=d.concat(i.trigger(i.scope+"click",e));d=d.concat(i._handleSelectors("click",e))}g(e,d)}}f=null;E=null};i._mouseup=i._pointerup;i._touchend=i._pointerup;i._click=function(e){var t,n=i.mouse(e),o="click",r=i.filter(e);i._resetSeqTimeout();if(r){if(n.left){t=i.trigger(i.scope+o,e)}t=i.trigger(i.scope+o+":"+n.buttonName,e);t=t.concat(i._handleSelectors(o,e));g(e,t)}};i._tap=i._click;i._dblclick=function(e){var t,n=i.mouse(e),o="dblclick",r=i.filter(e);i._resetSeqTimeout();if(r){if(n.left){t=i.trigger(i.scope+o,e)}t=i.trigger(i.scope+o+":"+n.buttonName,e);t=t.concat(i._handleSelectors(o,e));g(e,t)}};i._wheel=function(e){var t,n=i.filter(e),o="wheel";i._resetSeqTimeout();if(n){t=i.trigger(i.scope+o,e);t=t.concat(i._handleSelectors(o,e));if(e.deltaY>0){t=t.concat(i._doDownEvent(o+":down",e))}else if(e.deltaY<0){t=t.concat(i._doDownEvent(o+":up",e))}if(e.deltaZ>0){t=t.concat(i._doDownEvent(o+":out",e))}else if(e.deltaZ<0){t=t.concat(i._doDownEvent(o+":in",e))}if(e.deltaX>0){t=t.concat(i._doDownEvent(o+":right",e));if(i.isDown("shift")){t=t.concat(i.trigger(i.scope+o,e));t=t.concat(i._handleSelectors(o,e))}}else if(e.deltaX<0){t=t.concat(i._doDownEvent(o+":left",e));if(i.isDown("shift")){t=t.concat(i.trigger(i.scope+o,e));t=t.concat(i._handleSelectors(o,e))}}g(e,t)}};i._contextmenu=function(e){var t,n=i.filter(e),o="contextmenu";i._resetSeqTimeout();if(n){t=i.trigger(i.scope+o,e);t=t.concat(i._handleSelectors(o,e))}g(e,t)};i._composition=function(e){var t,n=i.filter(e),o=e.data,r="compos";if(n){t=i.trigger(i.scope+e.type,e,o);if(o){if(e.type=="compositionupdate"){r+='ing:"'+o+'"'}else if(e.type=="compositionend"){r+='ed:"'+o+'"'}t=t.concat(i.trigger(i.scope+r,e));t=t.concat(i._handleSelectors(r,e));g(e,t)}}};i._compositionstart=i._composition;i._compositionupdate=i._composition;i._compositionend=i._composition;i._clipboard=function(t){var n,o,r=i.filter(t),s=t.type+':"';if(r){if(e.clipboardData){n=e.clipboardData.getData("Text")}else if(t.clipboardData){n=t.clipboardData.getData("text/plain")}if(!n&&(t.type=="copy"||t.type=="cut")){n=i.getSelText()}if(n){o=i.trigger(i.scope+t.type,t,n);o=o.concat(i._handleSelectors(t.type,t,n));o=o.concat(i.trigger(i.scope+s+n+'"',t));o=o.concat(i._handleSelectors(s+n+'"',t));g(t,o)}}};i._paste=i._clipboard;i._copy=i._clipboard;i._cut=i._clipboard;i._select=function(e){var t,n=i.getSelText(),o=e.type+':"';t=i.trigger(i.scope+e.type,e,n);t=t.concat(i._handleSelectors(e.type,e,n));if(n){t=t.concat(i.trigger(i.scope+o+n+'"',e,n));t=t.concat(i._handleSelectors(o+n+'"',e));g(e,t)}};i.filter=function(e){var t=(e.target||e.srcElement).tagName,n=["keydown","keyup","keypress"];if(n.indexOf(e.type)!=-1){return!(t=="INPUT"||t=="SELECT"||t=="TEXTAREA")}return true};i.startRecording=function(){i.recording=true;b=[]};i.stopRecording=function(e){var t,n,o=new RegExp(e);i.recording=false;if(!e){return b}if(e=="keystroke"){for(var r=0;r<b.length;r++){if(b[r].indexOf("keyup")!=-1){break}n=b[r]}return n}t=b.filter(function(e){return o.test(e)});return t};i.isDown=function(e){var t,n,o,r=i._downEvents();e=e.toLowerCase();if(r.indexOf(e)!=-1){return true}for(t=0;t<i.down.length;t++){n=i.down[t].toLowerCase();o=a[t].toLowerCase();if(e==n||e==o){return true}else if(i.SHIFTKEYS.indexOf(i.down[t])!=-1){if(e==i.ShiftKeyEvent){return true}}else if(i.CONTROLKEYS.indexOf(i.down[t])!=-1){if(e==i.ControlKeyEvent){return true}}else if(i.ALTKEYS.indexOf(i.down[t])!=-1){if(e==i.AltKeyEvent){return true}}else if(i.OSKEYS.indexOf(i.down[t])!=-1){if(e==i.OSKeyEvent){return true}}}return false};i.getSelText=function(){var t="";if(e.getSelection){t=e.getSelection()}else if(document.getSelection){t=document.getSelection()}else if(document.selection){t=document.selection.createRange().text}else{return}return t.toString()};i.on=function(e,t,n,o){d(e).forEach(function(e){var r,s,a;if(e.indexOf(":")!=-1){a=":"}else if(e.indexOf(":")!=-1){a=" "}if(a){r=new RegExp(a+'(?=(?:(?:[^"]*"){2})*[^"]*$)',"g");s=e.split(r);e="";s.forEach(function(t){t=i.aliases[t]||t;e+=t+a});e=e.replace(new RegExp(a+"+$"),"")}e=i.aliases[e]||e;if(e.length==1&&_(e)){e="shift-"+e}e=e.toLowerCase();if(e.indexOf("-")!=-1){if(e.indexOf("->")==-1){e=i._normCombo(e)}}var c=i.events[e],l={callback:t,context:n,times:o};if(!c){c=i.events[e]=[]}c.push(l)});return i};i.once=function(e,t,n){return i.on(e,t,n,1)};i.off=function(e,t,n){var o,r;if(!arguments.length){i.events={}}else{e=e?d(e):Object.keys(i.events);for(o in e){var s=e[o],a=i.events[s];if(a){var c=[];for(var r in a){if(t){if(a[r].callback.toString()==t.toString()){if(n&&a[r].context!=n){c.push(a[r])}else if(n===null&&a[r].context){c.push(a[r])}}else{c.push(a[r])}}else if(n&&a[r].context!=n){c.push(a[r])}}if(!c.length){delete i.events[s]}else{i.events[s]=c}}}}return i};i.trigger=function(e){var t,n,o,r,s,a=[],c=[];e=d(e);Array.prototype.push.apply(c,arguments);c.shift();for(t=0;t<e.length;t++){o=i.aliases[e[t]]||e[t];i.log.debug("Triggering:",o,c);if(i.recording){b.push(o)}r=i.events[o];if(r){for(n=0;n<r.length;n++){s=r[n];if(s.times){s.times-=1;if(s.times==0){i.off(o,s.callback,s.context)}}a.push(s.callback.apply(s.context||this,c))}}}return a};i.emit=i.trigger;if(typeof document.hidden!=="undefined"){document.addEventListener("visibilitychange",function(e){if(document.hidden){i.trigger("document:hidden",e)}else{i.trigger("document:visible",e)}},false)}if(i.elem===e){["resize","beforeunload","hashchange","languagechange"].forEach(function(t){e.addEventListener(t,i._genericEvent.bind(i,"window"),true)});if(e.orientation!==undefined){e.addEventListener("orientationchange",function(t){i.trigger("window:orientation",t);if(Math.abs(e.orientation)===90){i.trigger("window:orientation:landscape",t)}else{i.trigger("window:orientation:portrait",t)}},false)}}i.init(i)};y.plugins=[];if(e.PointerEvent){y.defaultListenEvents=o.concat(i)}else{y.defaultListenEvents=o.concat(r)}y.noop=l;y.prototype.init=function(n){var o,i,r,f;n.scope="";n.down=[];n.modifiers={};n.seqBuffer=[];n.touches={};n.state={};n.aliases={tap:"click",middleclick:"pointer:middle",rightclick:"pointer:right",doubleclick:"dblclick",tripleclick:Array(4).join("pointer:left ").trim(),quadrupleclick:Array(5).join("pointer:left ").trim(),konami:"up up down down left right left right b a enter",portrait:"window:orientation:portrait",landscape:"window:orientation:landscape",hulksmash:"faceplant"};n.events={};s=false;a=[];c=null;if(n.settings.disableSequences){n._handleSeqEvents=l}if(n.settings.disableSelectors){n._handleSelectors=l}if(n.elem===e){n.on("window:resize",function(){if(e.outerWidth===screen.width&&e.outerHeight===screen.height){n.state.fullscreen=true;n.trigger("fullscreen",true)}else if(n.state.fullscreen){n.state.fullscreen=false;n.trigger("fullscreen",false)}})}n.off("hi:pause");n.on("hi:pause",function(){n.log.debug(n.l("Pause: Removing event listeners"));n.settings.listenEvents.forEach(function(e){var t=n.settings.eventOptions[e]||true;if(w.isFunction(n["_"+e])){n.elem.removeEventListener(e,n["_"+e],t)}})});n.off(["hi:initialized","hi:resume"]);n.on(["hi:initialized","hi:resume"],function(){n.log.debug("HumanInput Version: "+n.__version__);n.log.debug(n.l("Start/Resume: Addding event listeners"),n.settings.listenEvents);n.settings.listenEvents.forEach(function(e){var t=n.settings.eventOptions[e]||true;if(w.isFunction(n["_"+e])){n.elem.removeEventListener(e,n["_"+e],t);n.elem.addEventListener(e,n["_"+e],t)}else{n["_"+e]=n._genericEvent.bind(n,n.elem.name);n.elem.addEventListener(e,n["_"+e],t)}})});n.keyMaps={0:{Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,Left:37,ArrowUp:38,Up:38,ArrowRight:39,Right:39,ArrowDown:40,Down:40,PrintScreen:42,Insert:45,Delete:46,Semicolon:59,"=":61,OS:92,Select:93,NumLock:144,ScrollLock:145,VolumeDown:174,VolumeUp:175,MediaTrackPrevious:177,MediaPlayPause:179,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,AltGraph:225,Compose:229},1:{ShiftLeft:16,ControlLeft:17,AltLeft:18,OSLeft:91},2:{ShiftRight:16,ControlRight:17,AltRight:18,OSRight:92}};if(n.settings.uniqueNumpad){n.keyMaps[3]={NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:46,Slash:111}}else{n.keyMaps[3]={"*":106,"+":107,"-":109,".":46,"/":111}}for(o=48;o<=57;o++){n.keyMaps[0][o]=""+(o-48)}for(o=65;o<=90;o++){n.keyMaps[0][o]=String.fromCharCode(o)}for(o=96;o<=105;o++){n.keyMaps[3][o]="Numpad"+(o-96)}for(o=112;o<=123;o++){n.keyMaps[0][o]="F"+(o-112+1)}if(t){var f,u={3:"Enter",63289:"NumpadClear",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"ArrowLeft",63232:"ArrowUp",63235:"ArrowRight",63233:"ArrowDown",63302:"Insert",63272:"Delete"};for(f in u){n.keyMaps[0][f]=u[f]}for(o=63236;o<=63242;o++){n.keyMaps[0][o]="F"+(o-63236+1)}}for(o=0;o<=3;o++){Object.keys(n.keyMaps[o]).forEach(function(e){if(e.length>1&&!isNaN(e)){e=parseInt(e)}n.keyMaps[o][n.keyMaps[o][e]]=e})}if(y.plugins.length){for(o=0;o<y.plugins.length;o++){i=new y.plugins[o](n);n.log.debug(n.l("Initializing Plugin:"),i.__name__);if(w.isFunction(i.init)){r=i.init(n);for(f in r.exports){n[f]=r.exports[f]}}}}n.trigger("hi:initialized",n)};y.prototype.logger=function(t,n){var o=this,i=function(){var t=w.toArray(arguments);t[0]=n+o.levels[level]+" "+t[0];if(w.isFunction(e.console.log)){e.console.log.apply(e.console,t)}},r=i,s=i,a=i,c=i,f=function(t){var i=Array.prototype.slice.call(arguments,1);if(n.length){i.unshift(n)}if(t==40&&o.logLevel<=40){r.apply(e.console,i)}else if(t==30&&o.logLevel<=30){s.apply(e.console,i)}else if(t==20&&o.logLevel<=20){a.apply(e.console,i)}else if(t==10&&o.logLevel<=10){c.apply(e.console,i)}};n=n||"";o.levels={40:"ERROR",30:"WARNING",20:"INFO",10:"DEBUG",ERROR:40,WARNING:30,INFO:20,DEBUG:10};if(w.isFunction(e.console.error)){r=e.console.error}if(w.isFunction(e.console.warn)){s=e.console.warn}if(w.isFunction(e.console.info)){a=e.console.info}if(w.isFunction(e.console.debug)){c=e.console.debug}o.setLevel=function(e){e=e.toUpperCase();o.error=w.partial(f,40);o.warn=w.partial(f,30);o.info=w.partial(f,20);o.debug=w.partial(f,10);o.logLevel=e;if(isNaN(e)){o.logLevel=e=o.levels[e]}if(e>40){o.error=l}if(e>30){o.warn=l}if(e>20){o.info=l}if(e>10){o.debug=l}};o.setLevel(t)};y.prototype.pushScope=function(e){if(this.scope.length){this.scope=this.scope.slice(0,-1)+"."+e+":"}else{this.scope=e+":"}};y.prototype.popScope=function(){if(this.scope.length){this.scope=this.scope.slice(0,-1).split(".").slice(0,-1).join(".")+":"}if(this.scope==":"){this.scope=""}};y.prototype.pause=function(){this.state.paused=true;this.trigger("hi:pause",this)};y.prototype.resume=function(){this.state.paused=false;this.trigger("hi:resume",this)};y.prototype._seqSlicer=function(e){var t=[],n,o,i;e=e.split(/ +(?=(?:(?:[^"]*"){2})*[^"]*$)/g);for(n=0;n<e.length-1;n++){o=e.slice(n);i=o.join(" ");if(t.indexOf(i)==-1){t.push(i)}}return t};y.prototype._sortEvents=function(e){var t,n=this.MODIFIERPRIORITY;e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});e.sort(function(e,t){return t.length-e.length});e.sort(function(e,t){e=e.toLowerCase();t=t.toLowerCase();if(e in n){if(t in n){if(n[e]>n[t]){return-1}else if(n[e]<n[t]){return 1}else{return 0}}return-1}else if(t in n){return 1}else{return 0}});return e};y.prototype._normCombo=function(e){var t=this,n,o=e.split("-"),i=o.length,r=function(e){if(e=="control"){return t.ControlKeyEvent}return e},s=function(e){for(var n=0;n<t.AltAltNames.length;n++){if(e==t.AltAltNames[n]){return t.AltKeyEvent}}return e},a=function(e){for(var n=0;n<t.AltOSNames.length;n++){if(e==t.AltOSNames[n]){return t.OSKeyEvent}}return e};for(n=0;n<i;n++){if(o[n]==""){o[n]=="-"}o[n]=o[n].toLowerCase();o[n]=r(o[n]);o[n]=s(o[n]);o[n]=a(o[n])}t._sortEvents(o);return o.join("-")};y.prototype.mouse=function(e){var t={type:e.type};if(e.type!="mousemove"&&e.type!="wheel"){if(e.button==0){t.left=true;t.buttonName="left"}else if(e.button==1){t.middle=true;t.buttonName="middle"}else if(e.button==2){t.right=true;t.buttonName="right"}else if(e.button==3){t.back=true;t.buttonName="back"}else if(e.button==4){t.forward=true;t.buttonName="forward"}else if(e.button==5){t.forward=true;t.buttonName="eraser"}else{t.buttonName=e.button}}t.button=e.button;return t};if(typeof module!=="undefined"&&module.exports){module.exports=y}if(typeof define==="function"&&define.amd){define([],function(){return y})}else if(typeof exports!=="undefined"&&exports!==null){exports.HumanInput=y}else{e.HumanInput=y}}).call(this);(function(){"use strict";var e=function(e){var t=this;t.__name__="GamepadPlugin";t.exports={};t.gamepads=[];t._gamepadTimer=null;t.gamepadUpdate=function(){var n,o,i,r,s,a,c,l,f={type:"gamepad",target:e.elem},u=navigator.getGamepads();for(n=0;n<u.length;++n){if(u[n]){i=u[n].index,s=t.gamepads[i];if(!s){t.log.debug("Gamepad "+i+" detected:",u[n]);e.trigger("gpad:connected",u[n]);t.gamepads[i]={axes:[],buttons:[],timestamp:u[n].timestamp,id:u[n].id};s=t.gamepads[i];for(o=0;o<u[n].buttons.length;o++){s.buttons[o]={value:0,pressed:false}}for(o=0;o<u[n].axes.length;o++){s.axes[o]=0}continue}else{if(s.timestamp==u[n].timestamp){continue}r=JSON.parse(JSON.stringify(s));s.timestamp=u[n].timestamp;s.axes=u[n].axes.slice(0);for(o=0;o<r.buttons.length;o++){s.buttons[o].pressed=u[n].buttons[o].pressed;s.buttons[o].value=u[n].buttons[o].value}}for(o=0;o<s.buttons.length;o++){a="up";if(s.buttons[o].pressed){a="down"}c="gpad:button:"+o;if(a=="down"){if(!e.isDown(c)){e._addDown(c)}}else{if(e.isDown(c)){e._handleSeqEvents();e._removeDown(c)}}if(s.buttons[o].pressed!=r.buttons[o].pressed){e.trigger(e.scope+c+":"+a,s.buttons[o].value,u[n]);l=true}if(s.buttons[o].value!=r.buttons[o].value){e.trigger(e.scope+c+":value",s.buttons[o].value,u[n])}}if(e.filter(f)){for(o=0;o<r.axes.length;o++){if(s.axes[o]!=r.axes[o]){c="gpad:axis:"+o;e.trigger(e.scope+c,s.axes[o],u[n])}}if(l){e._handleDownEvents(u[n])}}}}};t.loadController=function(t){for(var n in t){e.aliases[n]=t[n]}};return t};e.prototype.init=function(e){var t=this,n=function(){clearInterval(t._gamepadTimer)},o=function(){clearInterval(t._gamepadTimer);if(t.gamepads.length){t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadInterval)}else{t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadCheckInterval)}};t.log=new e.logger(e.settings.logLevel||"INFO","[HI Gamepad]");t.log.debug(e.l("Initializing Gamepad Plugin"),t);e.settings.gpadInterval=e.settings.gpadInterval||100;e.settings.gpadCheckInterval=e.settings.gpadCheckInterval||3e3;clearInterval(t._gamepadTimer);if(e.settings.listenEvents.indexOf("gamepad")!=-1){t.gamepadUpdate();o();e.on("document:hidden",n);e.on("document:visibile",o)}t.exports.gamepads=t.gamepads;t.exports._gamepadTimer=t._gamepadTimer;t.exports.gamepadUpdate=t.gamepadUpdate;t.exports.loadController=t.loadController;return t};HumanInput.plugins.push(e)}).call(this);(function(){"use strict";HumanInput.defaultListenEvents.push("speech");var e=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition;var t=function(e){var t=this;t.__name__="SpeechRecPlugin";t.exports={};t._rtSpeech=[];t._rtSpeechPop=function(){t._rtSpeech.reverse();t._rtSpeech.pop();t._rtSpeech.reverse()};t._rtSpeechTimer=null;t.startSpeechRec=function(){t._recognition=new webkitSpeechRecognition;t.log.debug(e.l("Starting speech recognition"),t._recognition);t._recognition.lang=e.settings.speechLang||navigator.language||"en-US";t._recognition.continuous=true;t._recognition.interimResults=true;t._recognition.onresult=function(n){var o,i,r;for(o=n.resultIndex;o<n.results.length;++o){r=n.results[o][0].transcript.trim();if(n.results[o].isFinal){i='speech:"'+r.replace(/-/g,"–")+'"';e._addDown(i);e._handleDownEvents(n,r);e._handleSeqEvents();e._removeDown(i)}else{i="speech:rt:"+r.replace(/-/g,"–")+'"';if(t._rtSpeech.indexOf(i)==-1){t._rtSpeech.push(i);e._addDown(i);e._handleDownEvents(n,r);e._removeDown(i)}}}};t._started=true;t._recognition.start()};t.stopSpeechRec=function(){t.log.debug(e.l("Stopping speech recognition"));t._recognition.stop();t._started=false};return t};t.prototype.init=function(t){var n=this;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Speech]");n.log.debug(t.l("Initializing Speech Recognition Plugin"),n);t.settings.autostartSpeech=t.settings.autostartSpeech||false;if(t.settings.listenEvents.indexOf("speech")!=-1){if(e){if(t.settings.autostartSpeech){n.startSpeechRec()}t.on("document:hidden",function(){if(n._started){n.stopSpeechRec()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartSpeech){n.startSpeechRec()}})}else{n.startSpeechRec=t.noop;n.stopSpeechRec=t.noop}}n.exports.startSpeechRec=n.startSpeechRec;n.exports.stopSpeechRec=n.stopSpeechRec;return n};HumanInput.plugins.push(t)}).call(this);(function(){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;HumanInput.defaultListenEvents.push("clapper");var e=window.AudioContext||window.webkitAudioContext,t=60,n=function(n){var o=this;o.__name__="ClapperPlugin";o.exports={};o.startClapper=function(){var i=function(e){var i,r,s;o.stream=e;o.scriptProcessor.connect(o.context.destination);o.analyser.smoothingTimeConstant=.4;o.analyser.fftSize=128;o.streamSource=o.context.createMediaStreamSource(e);o.streamSource.connect(o.analyser);o.analyser.connect(o.scriptProcessor);o.scriptProcessor.onaudioprocess=function(){var e,a,c,l,f=Date.now();if(!i){i=f;r=f}e=f-i;a=f-r;c=f-s;if(e>t){o.analyser.getByteFrequencyData(o.freqData);if(a>=t*4&&o.freqData.filter(function(e){return e>=n.settings.clapThreshold}).length>=15){l="clap";if(a<t*8){l="doubleclap";s=f;if(c<t*12){l="applause"}}n._addDown(l);n._handleDownEvents();n._handleSeqEvents();n._removeDown(l);r=f}i=f}o.freqData=new Uint8Array(o.analyser.frequencyBinCount)}};o.context=new e;o.scriptProcessor=o.context.createScriptProcessor(1024,1,1);o.analyser=o.context.createAnalyser();o.freqData=new Uint8Array(o.analyser.frequencyBinCount);o.log.debug(n.l("Starting clap detection"));o._started=true;navigator.getUserMedia({audio:true},i,function(e){o.log.error(n.l("Could not get audio stream"),e)})};o.stopClapper=function(){o.log.debug(n.l("Stopping clap detection"));o.stream.getAudioTracks().forEach(function(e){e.stop()});o.stream.getVideoTracks().forEach(function(e){e.stop()});o.streamSource.disconnect(o.analyser);o.analyser.disconnect(o.scriptProcessor);o.scriptProcessor.disconnect(o.context.destination);o._started=false};return o};n.prototype.init=function(t){var n=this;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Clapper]");n.log.debug(t.l("Initializing Clapper Plugin"),n);t.settings.autostartClapper=t.settings.autostartClapper||false;t.settings.clapThreshold=t.settings.clapThreshold||120;t.settings.autotoggleClapper=t.settings.autotoggleClapper||true;if(t.settings.listenEvents.indexOf("clapper")!=-1){if(e){if(t.settings.autostartClapper){n.startClapper()}if(t.settings.autotoggleClapper){t.on("document:hidden",function(){if(n._started){n.stopClapper()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartClapper){n.startClapper()}})}}else{n.startClapper=t.noop;n.stopClapper=t.noop}}n.exports.startClapper=n.startClapper;n.exports.stopClapper=n.stopClapper;return n};HumanInput.plugins.push(n)}).call(this);
