(function(){"use strict";var e=this,t=e.HumanInput,n=e.screen,i=e.document,o=e.navigator.userAgent.indexOf("Mac OS X")!==-1,r=false,s=["click","compositionend","compositionstart","compositionupdate","contextmenu","copy","cut","hold","input","keydown","keypress","keyup","pan","paste","scroll","select","wheel"],a=["pointerdown","pointerup","pointercancel"],l=["mousedown","mouseup","touchstart","touchend","touchcancel"],c=false,u=function(e){return e},f=function(e){var t="";if(e.name){t+=" "+e.name}else if(e.id){t+=" "+e.id}else if(e.nodeName){t+=" "+e.nodeName}return"[HI"+t+"]"},p=function(e){if(typeof e==="string"){var t=i.querySelector(e);return t}return e},d=function(e){if(_.isString(e)){return[e]}return e},g=function(e,t){if(t.indexOf(false)!==-1){e.preventDefault();return true}},h=function(e){var t,n;if(_.isArray(e)){t=e.slice(0);for(n=0;n<t.length;n++){t[n]=h(t[n])}return t}else{return e}},m=function(e,t){var n=[],i,o,r;if(e.length===1){return e[0]}else{i=m(e.slice(1),t);for(o=0;o<i.length;o++){for(r=0;r<e[0].length;r++){n.push(e[0][r]+t+i[o])}}return n}},v=function(e,t){return/touch/.test(e.type)?(e.originalEvent||e).changedTouches[0]["page"+t]:e["page"+t]},_=_||u;["Function","String","Number"].forEach(function(e){_["is"+e]=function(t){return Object.prototype.toString.call(t)=="[object "+e+"]"}});_.isArray=Array.isArray;_.toArray=function(e){var t,n=[];for(t=e.length>>>0;t--;){n[t]=e[t]}return n};_.partial=function(e){var t=_.toArray(arguments).slice(1);return function(){return e.apply(this,t.concat(_.toArray(arguments)))}};_.isEqual=function(e,t){return e&&t&&typeof e==="object"&&typeof t==="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,i){return n&&_.isEqual(e[i],t[i])},true):e===t};_.debounce=function(e,t,n){var i,o;return function(){var r=this,s=arguments,a=function(){i=null;if(!n){o=e.apply(r,s)}},l=n&&!i;clearTimeout(i);i=setTimeout(a,t);if(l){o=e.apply(r,s)}return o}};if(Object.keys(e.KeyboardEvent.prototype).indexOf("key")!==-1){r=true}var HumanInput=function(t,n){if(!(this instanceof HumanInput)){return new HumanInput(t,n)}var o=this,s,a,l,w,S,y,E,b,C=0;if(HumanInput.instances.length){for(var x in HumanInput.instances){if(HumanInput.instances[x].elem===t){return HumanInput.instances[x]}}}HumanInput.instances.push(o);o.VERSION="1.0.18";o.OSKEYS=["OS","OSLeft","OSRight"],o.CONTROLKEYS=["Control","ControlLeft","ControlRight"],o.ALTKEYS=["Alt","AltLeft","AltRight"],o.SHIFTKEYS=["Shift","ShiftLeft","ShiftRight","⇧"],o.ALLMODIFIERS=o.OSKEYS.concat(o.CONTROLKEYS,o.ALTKEYS,o.SHIFTKEYS),o.MODPRIORITY={};o.ControlKeyEvent="ctrl";o.ShiftKeyEvent="shift";o.AltKeyEvent="alt";o.OSKeyEvent="os";o.AltAltNames=["option","⌥"];o.AltOSNames=["meta","win","⌘","cmd","command"];n=n||{};o.l=n.translate||u;n.listenEvents=n.listenEvents||HumanInput.defaultListenEvents;n.addEvents=n.addEvents||[];n.listenEvents=n.listenEvents.concat(n.addEvents);n.removeEvents=n.removeEvents||[];if(n.removeEvents.length){n.listenEvents=n.listenEvents.filter(function(e){return n.removeEvents.indexOf(e)===-1})}n.eventOptions=n.eventOptions||{};n.noKeyRepeat=n.noKeyRepeat||true;n.sequenceTimeout=n.sequenceTimeout||3500;n.holdInterval=n.holdInterval||250;n.maxSequenceBuf=n.maxSequenceBuf||12;n.uniqueNumpad=n.uniqueNumpad||false;n.swipeThreshold=n.swipeThreshold||50;n.moveThreshold=n.moveThreshold||5;n.disableSequences=n.disableSequences||false;n.disableSelectors=n.disableSelectors||false;n.eventMap=n.eventMap||{};o.settings=n;o.elem=p(t||e);o.log=new o.logger(n.logLevel||"INFO",f(t));y=o.CONTROLKEYS.concat(["ctrl"]);E=o.ALTKEYS.concat(o.AltAltNames);b=o.OSKEYS.concat(o.AltOSNames);for(s=0;s<y.length;s++){o.MODPRIORITY[y[s].toLowerCase()]=5}for(s=0;s<o.SHIFTKEYS.length;s++){o.MODPRIORITY[o.SHIFTKEYS[s].toLowerCase()]=4}for(s=0;s<E.length;s++){o.MODPRIORITY[E[s].toLowerCase()]=3}for(s=0;s<b.length;s++){o.MODPRIORITY[b[s].toLowerCase()]=2}o._resetStates=function(){o.state.modifiers={};o.state.seqBuffer=[];o.state.down=[];o.state.pointers={};o.state.downAlt=[];o.state.holdArgs=[];C=0;c=false;clearTimeout(o.state.holdTimeout);e.removeEventListener("mousemove",o._pointerMoveCheck,true)};o._pointerMoveCheck=function(t){var n=o.settings.moveThreshold;o.state.pointerX=v(t,"X");o.state.pointerY=v(t,"Y");if(o.state.pointerX){if(Math.abs(a-o.state.pointerX)>n||Math.abs(l-o.state.pointerY)>n){clearTimeout(o.state.holdTimeout);e.removeEventListener("mousemove",o._pointerMoveCheck,true)}}};o._holdCounter=function(){var t=o._downEvents(),n=o.state.holdArgs[o.state.holdArgs.length-1]||[],i=Date.now()-o.state.holdStart;o._resetSeqTimeout();for(s=0;s<t.length;s++){if(t[s].indexOf("pointer:")!==-1){e.removeEventListener("mousemove",o._pointerMoveCheck,true);e.addEventListener("mousemove",o._pointerMoveCheck,true)}o._triggerWithSelectors("hold:"+o.state.heldTime+":"+t[s],n.concat([i]))}o.state.heldTime+=o.settings.holdInterval;clearTimeout(o.state.holdTimeout);if(o.state.heldTime<5001){o.state.holdTimeout=setTimeout(o._holdCounter,o.settings.holdInterval)}};o._addDown=function(e,t){var n=o.state.down.indexOf(e);if(n===-1){n=o.state.downAlt.indexOf(e)}if(n===-1&&t){n=o.state.downAlt.indexOf(t)}if(n===-1){o.state.down.push(e);if(t){o.state.downAlt.push(t)}else{o.state.downAlt.push(e)}}};o._removeDown=function(t){var n=o.state.down.indexOf(t);clearTimeout(o.state.holdTimeout);e.removeEventListener("mousemove",o._pointerMoveCheck,true);if(n===-1){n=o.state.downAlt.indexOf(t)}if(n===-1){n=o.state.downAlt.indexOf(t.toUpperCase())}if(n!==-1){o.state.down.splice(n,1);o.state.downAlt.splice(n,1)}C=o.state.down.length;if(o.settings.listenEvents.indexOf("hold")!==-1){o.state.holdArgs.pop();o.state.heldTime=o.settings.holdInterval;o.state.holdStart=Date.now();if(o.state.down.length){o.state.holdTimeout=setTimeout(o._holdCounter,o.settings.holdInterval)}}};o._doDownEvent=function(e){var t,n=_.toArray(arguments).slice(1);o._addDown(e);t=o._handleDownEvents.apply(o,n);o._handleSeqEvents(n[0]);o._removeDown(e);return t};o._resetSeqTimeout=function(){clearTimeout(o.state.seqTimer);o.state.seqTimer=setTimeout(function(){o.log.debug(o.l("Resetting event states due to timeout"));o._resetStates()},o.settings.sequenceTimeout)};o._genericEvent=function(e,t){var n=o.filter(t),i;if(n){if(e.type){t=e;e=null}if(e){e=e+":"}else{e=""}i=o.trigger(o.scope+e+t.type,t);if(t.target){i=i.concat(o._handleSelectors(e+t.type,t))}g(t,i)}};o._handleSelectors=function(e){var t=[],n=_.toArray(arguments).slice(1),i=o,r;if(n[0]&&n[0].target){i=n[0].target;if(i.id){r=e+":#"+i.id;t=o.trigger.apply(i,[r].concat(n))}if(i.classList&&i.classList.length){for(var s=0;s<i.classList.length;s++){r=e+":."+i.classList.item(s);t=t.concat(o.trigger.apply(i,[r].concat(n)))}}}return t};o._triggerWithSelectors=function(e,t){var n=[],i=o.scope+e;n=n.concat(o.trigger.apply(o,[i].concat(t)));n=n.concat(o._handleSelectors.apply(o,[i].concat(t)));return n};o._keyEvent=function(e){if(o.CONTROLKEYS.indexOf(e)!==-1){return o.ControlKeyEvent}else if(o.ALTKEYS.indexOf(e)!==-1){return o.AltKeyEvent}else if(o.SHIFTKEYS.indexOf(e)!==-1){return o.ShiftKeyEvent}else if(o.OSKEYS.indexOf(e)!==-1){return o.OSKeyEvent}else{return e.toLowerCase()}};o._seqCombinations=function(e,t){var n,i,r=t||"-",s=h(e),a=[],l=[];for(n=0;n<e.length;n++){a.push(s[n].join(r).toLowerCase())}a=[a.join(" ")];for(n=0;n<e.length;n++){for(i=0;i<e[n].length;i++){s[n][i]=[o._keyEvent(e[n][i])]}}for(n=0;n<s.length;n++){if(s[n].length){l.push(m(s[n],r))}}for(n=0;n<l.length;n++){l[n]=o.eventMap.f[l[n]]||l[n]}l=l.join(" ");if(l!=a[0]){a.push(l)}return a};o._handleShifted=function(e){var t=e.length-1,n=-1;if(o.state.modifiers.shift){for(s=0;s<e.length;s++){n=e[s].indexOf("Shift");if(n!==-1){break}}}if(n!==-1){if(e[t]!=o.state.downAlt[t]){e.splice(n,1);return true}}};o._downEvents=function(){var e=[],t,n=o.state.down.slice(0),i=n.length,r=o.state.downAlt.slice(0);if(i){if(i===1){return o._seqCombinations([n])}if(i>1){t=o._handleShifted(n);e=e.concat(o._seqCombinations([n],"->"));if(t){e=e.concat(o._seqCombinations([r],"->"))}}if(n.length>1){o._sortEvents(n);e=e.concat(o._seqCombinations([n]))}if(t){o._sortEvents(r);e=e.concat(o._seqCombinations([r]))}}return e};o._handleDownEvents=function(){var e,t,n,i=_.toArray(arguments);t=o._downEvents();for(e=0;e<t.length;e++){n=o._triggerWithSelectors(t[e],i)}if(o.settings.listenEvents.indexOf("hold")!==-1){o.state.holdArgs.push(i);o.state.heldTime=o.settings.holdInterval;o.state.holdStart=Date.now();clearTimeout(o.state.holdTimeout);o.state.holdTimeout=setTimeout(o._holdCounter,o.settings.holdInterval)}return n};o._handleSeqEvents=function(e){var t,n,i,r,s,a=o.state.down.slice(0);if(C<a.length){if(o.sequenceFilter(e)){o._handleShifted(a);o._sortEvents(a);o.state.seqBuffer.push(a);if(o.state.seqBuffer.length>o.settings.maxSequenceBuf){o.state.seqBuffer.shift()}if(o.state.seqBuffer.length>1){t=o._seqCombinations(o.state.seqBuffer);for(n=0;n<t.length;n++){s=o._seqSlicer(t[n]);for(i=0;i<s.length;i++){r=o.trigger(o.scope+s[i],o)}}if(r.length){o.state.seqBuffer=[]}}}}o._resetSeqTimeout()};o._normSpecial=function(e,t,n){if(t==" "){return n}if(n.indexOf("Left")!==-1||n.indexOf("Right")!==-1){t=n}else if(o.settings.uniqueNumpad&&e===3){return"numpad"+t}if(t.indexOf("Arrow")===0){t=t.substr(5)}return t};o._setModifiers=function(e,t){if(o.ALLMODIFIERS.indexOf(e)){if(o.SHIFTKEYS.indexOf(e)!==-1){o.state.modifiers.shift=t}if(o.CONTROLKEYS.indexOf(e)!==-1){o.state.modifiers.ctrl=t}if(o.ALTKEYS.indexOf(e)!==-1){o.state.modifiers.alt=t;o.state.modifiers.option=t;o.state.modifiers["⌥"]=t}if(o.OSKEYS.indexOf(e)!==-1){o.state.modifiers.meta=t;o.state.modifiers.command=t;o.state.modifiers.os=t;o.state.modifiers["⌘"]=t}o.state.modifiers[e]=t}};o._keydown=function(e){var t,n=e.which||e.keyCode,i=e.location||0,s=o.keyMaps[i][n]||o.keyMaps[0][n]||e.code,a=e.key||s,l=e.type,c=o.scope+"faceplant",u=o.filter(e);a=o._normSpecial(i,a,s);o._setModifiers(a,true);if(a=="Compose"){o.state.composing=true;return}if(o.state.down.indexOf(a)===-1){o._addDown(a,s)}o._resetSeqTimeout();if(u){if(e.repeat&&o.settings.noKeyRepeat){e.preventDefault();return false}t=o._triggerWithSelectors(l,[e,a,s]);t=t.concat(o._triggerWithSelectors(l+=":"+a.toLowerCase(),[e,a,s]));if(o.state.down.length>5){t=t.concat(o.trigger(c,e))}if(r){t=t.concat(o._handleDownEvents(e,a,s))}g(e,t)}};o._keypress=function(e){var t=e.charCode||e.which,n=e.key||String.fromCharCode(t);if(!r&&t>47&&n.length){o.state.down.pop();o.state.down.push(n)}};o._keyup=function(e){var t,n=e.which||e.keyCode,i=e.location||0,s=o.keyMaps[i][n]||o.keyMaps[0][n]||e.code,a=e.key||s,l=e.type,c=o.filter(e);a=o._normSpecial(i,a,s);if(!o.state.downAlt.length){return}if(o.state.composing){o.state.composing=false;return}if(c){if(!r){o._handleDownEvents(e)}t=o._triggerWithSelectors(l,[e,a,s]);t=t.concat(o._triggerWithSelectors(l+":"+a.toLowerCase(),[e,a,s]));o._handleSeqEvents(e);g(e,t)}o._removeDown(a);o._setModifiers(s,false)};o._trackMotion=function(e){var t,n=[],i="pan",r={},a=o.state.pointers,l=e.touches,c=e.pointerType,u=o.filter(e);if(c){t=e.pointerId;if(!a[t]){return}a[t].event=e}else if(l&&l.length){for(s=0;s<l.length;s++){t=l[s].identifier;if(!a[t]){return}a[t].event=l[s]}}r.origX=a[t].x;r.origY=a[t].y;r.x=e.clientX||a[t].event.clientX;r.y=e.clientY||a[t].event.clientY;o._resetSeqTimeout();if(u){if(o.state.pointerCount>1){i="multitouch:";n=n.concat(o._triggerWithSelectors(i+"pan",[e,a]));n=n.concat(o._triggerWithSelectors(i+o.state.pointerCount+":pan",[e,a]))}else{n=n.concat(o._triggerWithSelectors(i,[e,r]))}g(e,n)}};o._pointerdown=function(t){var n,i,r=o.mouse(t),s,a=t.changedTouches,l=t.pointerType,c="pointer",u=":down",f=o.filter(t);if(t.type=="mousedown"&&S){return}if(l){i=t.pointerId;o.state.pointers[i]={x:t.clientX,y:t.clientY,event:t,timestamp:Date.now()}}else if(a&&a.length){for(n=0;n<a.length;n++){i=a[n].identifier;o.state.pointers[i]={x:a[n].clientX,y:a[n].clientY,event:a[n],timestamp:Date.now()}}S=true;r.buttonName="left"}o.state.pointerCount++;if(o.state.pointerCount>1||o.settings.listenEvents.indexOf("pan")!=-1){if(e.PointerEvent){o.elem.removeEventListener("pointermove",o._trackMotion,true);o.elem.addEventListener("pointermove",o._trackMotion,true)}else{o.elem.removeEventListener("touchmove",o._trackMotion,true);o.elem.addEventListener("touchmove",o._trackMotion,true)}}o._addDown(c+":"+r.buttonName);o._resetSeqTimeout();if(f){s=o._triggerWithSelectors(c+u,[t]);if(r.buttonName!==undefined){c+=":"+r.buttonName;s=s.concat(o._triggerWithSelectors(c+u,[t]))}s=s.concat(o._handleDownEvents(t));g(t,s)}};o._mousedown=o._pointerdown;o._touchstart=o._pointerdown;o._pointerup=function(e){var t,n,i,r,s,a=e.clientX,l=e.clientY,c=o.state.pointers,u={},f=e.changedTouches,p=e.pointerType,d=o.settings.swipeThreshold,h="up",m="pointer:",v=o.filter(e);if(e.type=="mouseup"&&S){return}if(p){n=e.pointerId}else if(f&&f.length){for(t=0;t<f.length;t++){n=f[t].identifier;a=f[t].clientX;l=f[t].clientY}}if(c[n]){u.x=c[n].x-a;u.y=c[n].y-l}o._resetSeqTimeout();if(v){s=o._triggerWithSelectors(m+h,[e]);i=o.mouse(e);if(i.buttonName!==undefined){m+=i.buttonName}else{m+="left"}s=s.concat(o._triggerWithSelectors(m+":"+h,[e]));r="swipe:";if(Math.abs(u.x)>Math.abs(u.y)){if(u.x>d){r+="left"}else if(u.x<-d){r+="right"}}else{if(u.y>d){r+="up"}else if(u.y<-d){r+="down"}}}delete c[n];o.state.pointerCount--;if(o.state.pointerCount){if(u.x<5&&u.y<5){o.state.multitap++}else{o.state.multitap=0}}else{if(o.state.multitap){if(v){r="multitouch:"+(o.state.multitap+1)+":tap";s=o._triggerWithSelectors(r,[e]);o._removeDown(m);o._addDown(r);s=s.concat(o._handleDownEvents(e));o._handleSeqEvents(e);o._removeDown(r)}o.state.multitap=0}else{if(v){if(r!="swipe:"){o._removeDown(m);o._addDown(r);s=s.concat(o._handleDownEvents(e));o._handleSeqEvents(e);o._removeDown(r)}else{o._handleSeqEvents(e);o._removeDown(m);g(e,s)}}}o.elem.removeEventListener("pointermove",o._trackMotion,true);o.elem.removeEventListener("touchmove",o._trackMotion,true)}};o._mouseup=o._pointerup;o._touchend=o._pointerup;o._pointercancel=function(e){var t,n,i=o.state.pointers,r=e.changedTouches,s=e.pointerType,a="pointer:",l=o.mouse(e);if(s){n=e.pointerId;if(i[n]){delete i[n]}}else if(r&&r.length){for(t=0;t<r.length;t++){n=r[t].identifier;if(i[n]){delete i[n]}}l.buttonName="left"}o._removeDown(a+l.buttonName);o.state.pointerCount--;if(!o.state.pointerCount){o.elem.removeEventListener("pointermove",o._trackMotion,true);o.elem.removeEventListener("touchmove",o._trackMotion,true)}};o._touchcancel=o._pointercancel;o._click=function(e){var t,n=e.type,i=e.detail,r=o.filter(e);if(i===2){n="dblclick"}else if(i===3){n="tripleclick"}o._resetSeqTimeout();if(r){o._addDown(n);t=o._handleDownEvents(e);o._removeDown(n);g(e,t)}};o._tap=o._click;o._wheel=function(e){var t,n=o.filter(e),i="wheel";o._resetSeqTimeout();if(n){t=o._triggerWithSelectors(i,[e]);if(e.deltaY>0){t=t.concat(o._doDownEvent(i+":down",e))}else if(e.deltaY<0){t=t.concat(o._doDownEvent(i+":up",e))}if(e.deltaZ>0){t=t.concat(o._doDownEvent(i+":out",e))}else if(e.deltaZ<0){t=t.concat(o._doDownEvent(i+":in",e))}if(e.deltaX>0){t=t.concat(o._doDownEvent(i+":right",e));if(o.isDown("shift")){t=t.concat(o._triggerWithSelectors(i+":right",[e]))}}else if(e.deltaX<0){t=t.concat(o._doDownEvent(i+":left",e));if(o.isDown("shift")){t=t.concat(o._triggerWithSelectors(i+":left",[e]))}}g(e,t)}};o._scroll=function(e){var t,n,i,r=e.target,s=r.scrollLeft,a=r.scrollTop;if(r.scrollingElement){s=r.scrollingElement.scrollLeft;a=r.scrollingElement.scrollTop}n=s-o.state.scrollX;i=a-o.state.scrollY;if(i===0&&n===0){return}t=o._triggerWithSelectors(e.type,[e,{x:n,y:i}]);if(s!==undefined&&s!==o.state.scrollX){n=Math.abs(n);if(s>o.state.scrollX){t=t.concat(o._triggerWithSelectors(e.type+":right",[e,n]))}else{t=t.concat(o._triggerWithSelectors(e.type+":left",[e,n]))}o.state.scrollX=s}if(a!==undefined&&a!==o.state.scrollY){i=Math.abs(i);if(a>o.state.scrollY){t=t.concat(o._triggerWithSelectors(e.type+":down",[e,i]))}else{t=t.concat(o._triggerWithSelectors(e.type+":up",[e,i]))}o.state.scrollY=a}g(e,t)};o._contextmenu=function(e){var t,n=o.filter(e);if(n){t=o._triggerWithSelectors(e.type,[e]);if(!g(e,t)){o._resetStates()}}};o._composition=function(e){var t,n=o.filter(e),i=e.data,r="compos";if(n){t=o._triggerWithSelectors(e.type,[e,i]);if(i){if(e.type=="compositionupdate"){r+='ing:"'+i+'"'}else if(e.type=="compositionend"){r+='ed:"'+i+'"'}t=t.concat(o._triggerWithSelectors(r,[e]));g(e,t)}}};o._compositionstart=o._composition;o._compositionupdate=o._composition;o._compositionend=o._composition;o._clipboard=function(t){var n,i,r=o.filter(t),s=t.type+':"';if(r){if(e.clipboardData){n=e.clipboardData.getData("Text")}else if(t.clipboardData){n=t.clipboardData.getData("text/plain")}if(!n&&(t.type=="copy"||t.type=="cut")){n=o.getSelText()}if(n){i=o._triggerWithSelectors(t.type,[t,n]);i=i.concat(o._triggerWithSelectors(s+n+'"',[t]));g(t,i)}}};o._paste=o._clipboard;o._copy=o._clipboard;o._cut=o._clipboard;o._select=function(e){var t,n,i=o.filter(e),r=e.type+':"';if(e.type=="select"){n=o.getSelText()}else if(e.type=="input"){n=e.data||e.target.value}if(i){t=o._triggerWithSelectors(e.type,[e,n]);if(n){t=t.concat(o._triggerWithSelectors(r+n+'"',[e]));g(e,t)}}};o._input=o._select;o.filter=function(e){var t=(e.target||e.srcElement).tagName,n=["keydown","keyup","keypress"];if(n.indexOf(e.type)!==-1){return!(t=="INPUT"||t=="SELECT"||t=="TEXTAREA")}return true};o.sequenceFilter=function(e){return true};o.isUpper=function(e){if(e==e.toUpperCase()&&e!=e.toLowerCase()){return true}};o.startRecording=function(){o.recording=true;w=[]};o.stopRecording=function(e){var t,n,i,r=new RegExp(e),s=function(e){return e.indexOf(":#")===-1&&e.indexOf(":.")===-1};o.recording=false;if(!e){return w}if(e=="keystroke"){i=w.filter(s);r=new RegExp("keyup");for(var a=0;a<i.length;a++){if(r.test(i[a])){break}n=i[a]}return n}t=w.filter(function(e){return r.test(e)});return t};o.isDown=function(e){var t,n,i,r=o._downEvents();e=e.toLowerCase();e=o.eventMap.r[e]||e;if(r.indexOf(e)!==-1){return true}for(t=0;t<o.state.down.length;t++){n=o.state.down[t].toLowerCase();i=o.state.downAlt[t].toLowerCase();if(e==n||e==i){return true}else if(o.SHIFTKEYS.indexOf(o.state.down[t])!==-1){if(e==o.ShiftKeyEvent){return true}}else if(o.CONTROLKEYS.indexOf(o.state.down[t])!==-1){if(e==o.ControlKeyEvent){return true}}else if(o.ALTKEYS.indexOf(o.state.down[t])!==-1){if(e==o.AltKeyEvent){return true}}else if(o.OSKEYS.indexOf(o.state.down[t])!==-1){if(e==o.OSKeyEvent){return true}}}return false};o.getSelText=function(){var t="";if(e.getSelection){t=e.getSelection()}else if(i.selection){t=i.selection.createRange().text}else{return}return t.toString()};o._handleAliases=function(e){e=o.aliases[e]||e;if(e.length===1&&o.isUpper(e)){e="shift-"+e}return e};o.on=function(e,t,n,i){d(e).forEach(function(e){var r,s,a,l;if(e.indexOf(":")!==-1){l=":"}else if(e.indexOf(" ")!==-1){l=" "}if(l){s=new RegExp(l+'(?=(?:(?:[^"]*"){2})*[^"]*$)',"g");a=e.split(s);e="";for(r=0;r<a.length;r++){e+=o._handleAliases(a[r])+l}e=e.replace(new RegExp(l+"+$"),"")}else{e=o._handleAliases(e)}e=e.toLowerCase();if(e.indexOf("-")!==-1){if(e.indexOf("->")===-1){e=o._normCombo(e)}}if(!n){n={}}var c=o.events[e],u={callback:t,context:n,times:i};if(!c){c=o.events[e]=[]}c.push(u)});return o};o.once=function(e,t,n){return o.on(e,t,n,1)};o.one=o.once;o.off=function(e,t,n){var i,r;if(!arguments.length){o.events={}}else{e=e?d(e):Object.keys(o.events);for(i in e){var s=e[i],a=o.events[s];if(a){var l=[];if(!n){if(!t){delete o.events[s];break}}for(r=0;r<a.length;r++){if(t){if(a[r].callback.toString()==t.toString()){if((n===null||n===undefined)&&a[r].context){l.push(a[r])}else if(!_.isEqual(a[r].context,n)){l.push(a[r])}}else{l.push(a[r])}}else if(n&&a[r].context!==n){l.push(a[r])}}if(!l.length){delete o.events[s]}else{o.events[s]=l}}}}return o};o.trigger=function(t){var n,i,r,s=[],a=_.toArray(arguments).slice(1);d(t).forEach(function(t){t=o.aliases[t]||t;t=o.eventMap.f[t]||t;o.log.debug("Triggering:",t,a.length?a:"");if(o.recording){w.push(t)}i=o.events[t];if(i){for(n=0;n<i.length;n++){r=i[n];if(r.context!==e){r.context.HIEvent=t}if(r.times){r.times-=1;if(r.times===0){o.off(t,r.callback,r.context)}}s.push(r.callback.apply(r.context||this,a))}}});return s};o.emit=o.trigger;if(typeof i.hidden!=="undefined"){i.addEventListener("visibilitychange",function(e){if(i.hidden){o.trigger("document:hidden",e)}else{o.trigger("document:visible",e)}},false)}if(e.onblur!==undefined){e.addEventListener("blur",function(e){o.trigger("window:blur",e)},false);e.addEventListener("focus",function(e){o.trigger("window:focus",e)},false)}if(o.elem===e){["beforeunload","hashchange","languagechange"].forEach(function(t){e.addEventListener(t,o._genericEvent.bind(o,"window"),true)});e.addEventListener("resize",_.debounce(o._genericEvent.bind(o,"window"),250),true);if(e.orientation!==undefined){e.addEventListener("orientationchange",function(t){var n="window:orientation";o.trigger(n,t);if(Math.abs(e.orientation)===90){o.trigger(n+":landscape",t)}else{o.trigger(n+":portrait",t)}},false)}}o.init(o)};HumanInput.instances=[];HumanInput.plugins=[];if(e.PointerEvent){HumanInput.defaultListenEvents=s.concat(a)}else{HumanInput.defaultListenEvents=s.concat(l)}HumanInput.noop=u;HumanInput.prototype.init=function(t){var i,r,s,a;t=t||this;if(t.events){t.trigger("hi:reset")}t.scope="";t.state={down:[],downAlt:[],holdStart:null,holdArgs:[],modifiers:{},multitap:0,pointerCount:0,pointers:{},scrollX:0,scrollY:0,seqBuffer:[]};t.aliases={tap:"click",taphold:"hold:1500:pointer:left",clickhold:"hold:1500:pointer:left",middleclick:"pointer:middle",rightclick:"pointer:right",doubleclick:"dblclick",konami:"up up down down left right left right b a enter",portrait:"window:orientation:portrait",landscape:"window:orientation:landscape",hulksmash:"faceplant",twofingertap:"multitouch:2:tap",threefingertap:"multitouch:3:tap",fourfingertap:"multitouch:4:tap"};t.events={};t.eventMap={f:{},r:{}};t.map(t.settings.eventMap);c=false;if(t.settings.disableSequences){t._handleSeqEvents=u}if(t.settings.disableSelectors){t._handleSelectors=u}if(t.elem===e){t.on("window:resize",function(){if(e.outerWidth===n.width&&e.outerHeight===n.height){t.state.fullscreen=true;t.trigger("fullscreen",true)}else if(t.state.fullscreen){t.state.fullscreen=false;t.trigger("fullscreen",false)}})}t.off("hi:pause");t.on("hi:pause",function(){t.log.debug(t.l("Pause: Removing event listeners ",t.settings.listenEvents));t.settings.listenEvents.forEach(function(e){var n=t.settings.eventOptions[e]||true;if(_.isFunction(t["_"+e])){t.elem.removeEventListener(e,t["_"+e],n)}})});t.off(["hi:initialized","hi:resume"]);t.on(["hi:initialized","hi:resume"],function(){t.log.debug("HumanInput Version: "+t.VERSION);t.log.debug(t.l("Start/Resume: Addding event listeners"),t.settings.listenEvents);t.settings.listenEvents.forEach(function(e){var n=t.settings.eventOptions[e]||true;if(_.isFunction(t["_"+e])){t.elem.removeEventListener(e,t["_"+e],n);t.elem.addEventListener(e,t["_"+e],n)}else{t["_"+e]=t._genericEvent.bind(t,"");t.elem.addEventListener(e,t["_"+e],n)}})});t.on("window:blur",t._resetStates);t.keyMaps={0:{Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,Left:37,ArrowUp:38,Up:38,ArrowRight:39,Right:39,ArrowDown:40,Down:40,PrintScreen:42,Insert:45,Delete:46,Semicolon:59,"=":61,OS:92,Select:93,NumLock:144,ScrollLock:145,VolumeDown:174,VolumeUp:175,MediaTrackPrevious:177,MediaPlayPause:179,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,AltGraph:225,Compose:229},1:{ShiftLeft:16,ControlLeft:17,AltLeft:18,OSLeft:91},2:{ShiftRight:16,ControlRight:17,AltRight:18,OSRight:92}};if(t.settings.uniqueNumpad){t.keyMaps[3]={NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:46,Slash:111}}else{t.keyMaps[3]={"*":106,"+":107,"-":109,".":46,"/":111}}for(i=48;i<=57;i++){t.keyMaps[0][i]=""+(i-48)}for(i=65;i<=90;i++){t.keyMaps[0][i]=String.fromCharCode(i)}for(i=96;i<=105;i++){t.keyMaps[3][i]="Numpad"+(i-96)}for(i=112;i<=123;i++){t.keyMaps[0][i]="F"+(i-112+1)}if(o){var l={3:"Enter",63289:"NumpadClear",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"ArrowLeft",63232:"ArrowUp",63235:"ArrowRight",63233:"ArrowDown",63302:"Insert",63272:"Delete"};for(a in l){t.keyMaps[0][a]=l[a]}for(i=63236;i<=63242;i++){t.keyMaps[0][i]="F"+(i-63236+1)}}for(i=0;i<=3;i++){Object.keys(t.keyMaps[i]).forEach(function(e){if(e.length>1&&!isNaN(e)){e=parseInt(e)}t.keyMaps[i][t.keyMaps[i][e]]=e})}if(HumanInput.plugins.length){for(i=0;i<HumanInput.plugins.length;i++){r=new HumanInput.plugins[i](t);t.log.debug(t.l("Initializing Plugin:"),r.__name__);if(_.isFunction(r.init)){s=r.init(t);for(a in s.exports){t[a]=s.exports[a]}}}}t.trigger("hi:initialized",t)};HumanInput.prototype.logger=function(t,n){var i=this,o=function(t){var o=_.toArray(arguments);o[0]=n+i.levels[t]+" "+o[0];if(_.isFunction(e.console.log)){e.console.log.apply(e.console,o)}},r=o,s=o,a=o,l=o,c=function(t){var o=Array.prototype.slice.call(arguments,1);if(n.length){o.unshift(n)}if(t===40&&i.logLevel<=40){r.apply(e.console,o)}else if(t===30&&i.logLevel<=30){s.apply(e.console,o)}else if(t===20&&i.logLevel<=20){a.apply(e.console,o)}else if(t===10&&i.logLevel<=10){l.apply(e.console,o)}};n=n||"";i.levels={40:"ERROR",30:"WARNING",20:"INFO",10:"DEBUG",ERROR:40,WARNING:30,INFO:20,DEBUG:10};if(_.isFunction(e.console.error)){r=e.console.error}if(_.isFunction(e.console.warn)){s=e.console.warn}if(_.isFunction(e.console.info)){a=e.console.info}if(_.isFunction(e.console.debug)){l=e.console.debug}i.setLevel=function(e){e=e.toUpperCase();i.error=_.partial(c,40);i.warn=_.partial(c,30);i.info=_.partial(c,20);i.debug=_.partial(c,10);i.logLevel=e;if(isNaN(e)){i.logLevel=e=i.levels[e]}if(e>40){i.error=u}if(e>30){i.warn=u}if(e>20){i.info=u}if(e>10){i.debug=u}};i.setLevel(t)};HumanInput.prototype.pushScope=function(e){if(this.scope.length){this.scope=this.scope.slice(0,-1)+"."+e+":"}else{this.scope=e+":"}};HumanInput.prototype.popScope=function(){if(this.scope.length){this.scope=this.scope.slice(0,-1).split(".").slice(0,-1).join(".")+":"}if(this.scope==":"){this.scope=""}};HumanInput.prototype.pause=function(){this.state.paused=true;this.trigger("hi:pause",this)};HumanInput.prototype.resume=function(){this.state.paused=false;this.trigger("hi:resume",this)};HumanInput.prototype.map=function(e){for(var t in e){this.eventMap.f[t]=e[t];this.eventMap.r[e[t]]=t}};HumanInput.prototype._seqSlicer=function(e){var t=[],n,i,o;e=e.split(/ +(?=(?:(?:[^"]*"){2})*[^"]*$)/g);for(n=0;n<e.length-1;n++){i=e.slice(n);o=i.join(" ");if(t.indexOf(o)===-1){t.push(o)}}return t};HumanInput.prototype._sortEvents=function(e){var t=this.MODPRIORITY;e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});e.sort(function(e,t){return t.length-e.length});e.sort(function(e,n){e=e.toLowerCase();n=n.toLowerCase();if(e in t){if(n in t){if(t[e]>t[n]){return-1}else if(t[e]<t[n]){return 1}else{return 0}}return-1}else if(n in t){return 1}else{return 0}});return e};HumanInput.prototype._normCombo=function(e){var t=this,n,i=e.split("-"),o=function(e){if(e=="control"){return t.ControlKeyEvent}return e},r=function(e){for(var n=0;n<t.AltAltNames.length;n++){if(e==t.AltAltNames[n]){return t.AltKeyEvent}}return e},s=function(e){for(var n=0;n<t.AltOSNames.length;n++){if(e==t.AltOSNames[n]){return t.OSKeyEvent}}return e};for(n=0;n<i.length;n++){i[n]=i[n].toLowerCase();i[n]=o(i[n]);i[n]=r(i[n]);i[n]=s(i[n])}t._sortEvents(i);return i.join("-")};HumanInput.prototype.getDown=function(){var e=this,t,n=e._sortEvents(e.state.down.slice(0)),i=new RegExp("-$"),o="";for(t=0;t<n.length;t++){o+=e._keyEvent(n[t])+"-"}return o.replace(i,"")};HumanInput.prototype.mouse=function(e){var t={type:e.type};if(e.type!="mousemove"&&e.type!="wheel"){if(e.button===0){t.left=true;t.buttonName="left"}else if(e.button===1){t.middle=true;t.buttonName="middle"}else if(e.button===2){t.right=true;t.buttonName="right"}else if(e.button===3){t.back=true;t.buttonName="back"}else if(e.button===4){t.forward=true;t.buttonName="forward"}else if(e.button===5){t.forward=true;t.buttonName="eraser"}else{t.buttonName=e.button}}t.button=e.button;return t};HumanInput.noConflict=function(){e.HumanInput=t;return HumanInput};if(typeof module!=="undefined"&&module.exports){module.exports=HumanInput}if(typeof define==="function"&&define.amd){define([],function(){return HumanInput})}else if(typeof exports!=="undefined"&&exports!==null){exports.HumanInput=HumanInput}else{e.HumanInput=HumanInput}}).call(this);(function(){"use strict";var e=this;if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var n=this.toString();if(typeof t!=="number"||!isFinite(t)||Math.floor(t)!==t||t>n.length){t=n.length}t-=e.length;var i=n.indexOf(e,t);return i!==-1&&i===t}}HumanInput.defaultListenEvents.push("idle");var t=function(e){var t=this;t.HI=e;t.__name__="IdlePlugin";t.exports={};return t},n=function(e){if(isNaN(e)){var t=parseInt(e.slice(0,-1));if(e.endsWith("s")){return t*1e3}else if(e.endsWith("m")){return t*1e3*60}else if(e.endsWith("h")){return t*1e3*60*60}else if(e.endsWith("d")){return t*1e3*60*60*24}else if(e.endsWith("M")){return t*1e3*60*60*24*30}else if(e.endsWith("y")){return t*1e3*60*60*24*365}else{return parseInt(e)}}else{return e}};t.prototype.init=function(t){var i=this,o,r;i.log=new t.logger(t.settings.logLevel||"INFO","[HI Idle]");i.log.debug(t.l("Initializing Idle Plugin"),i);i.lastActivity=new Date;i.timeout=null;t.settings.autostartIdle=t.settings.autostartIdle||true;o=t.settings.idleTimeout||"5m";i.idleTimeout=n(o);r=t.settings.idleCheckInterval||"5s";i.idleCheckInterval=n(r);i.mouseMoveCheck=function(){clearTimeout(i.mouseMoveTimeout);i.lastActivity=new Date;e.removeEventListener("mousemove",i.mouseMoveCheck,true);e.removeEventListener("mousemove",i.resetTimeout,true);i.mouseMoveTimeout=setTimeout(function(){e.addEventListener("mousemove",i.mouseMoveCheck,true)},i.idleCheckInterval)};i.resetTimeout=function(){i.log.debug(t.l("Activity detected; resetting idle timeout"));i.mouseMoveCheck();clearTimeout(i.timeout);i.timeout=setTimeout(i.idleCheck,i.idleCheckInterval)};i.startIdleChecker=function(){t.on(["click","keydown","scroll"],i.resetTimeout);i.resetTimeout();t.on("idle",function(){i.stopIdleChecker();t.once(["click","keydown","scroll"],i.resetTimeout);e.addEventListener("mousemove",i.resetTimeout,true)});t.once("hi:reset",i.stopIdleChecker)};i.stopIdleChecker=function(){e.removeEventListener("mousemove",i.mouseMoveCheck,true);t.off(["click","keydown","scroll"],i.resetTimeout);clearTimeout(i.timeout);clearTimeout(i.mouseMoveTimeout)};i.idleCheck=function(){clearTimeout(i.timeout);if(Date.now()-i.lastActivity.getTime()>i.idleTimeout){i.HI.trigger("idle",i.lastActivity)}else{i.timeout=setTimeout(i.idleCheck,i.idleCheckInterval)}};if(t.settings.listenEvents.indexOf("idle")!=-1){if(t.settings.autostartIdle){i.startIdleChecker()}}i.exports.startIdleChecker=i.startIdleChecker;i.exports.stopIdleChecker=i.stopIdleChecker;return i};HumanInput.plugins.push(t)}).call(this);(function(){"use strict";var e=function(e){var t=navigator.getGamepads(),n;for(n=0;n<t.length;n++){if(t[n]&&t[n].index==e){return true}}},t=function(t){var n=this;n.__name__="GamepadPlugin";n.exports={};n.gamepads=[];n._gamepadTimer=null;n.gamepadUpdate=function(){var i,o,r,s,a,l,c,u,f={type:"gamepad",target:t.elem},p=t.filter(f),d=navigator.getGamepads();for(i=0;i<n.gamepads.length;i++){if(n.gamepads[i]&&!e(i)){t.trigger("gpad:disconnected",n.gamepads[i]);n.gamepads[i]=null}}for(i=0;i<d.length;++i){if(d[i]){r=d[i].index,a=n.gamepads[r];if(!a){n.log.debug("Gamepad "+r+" detected:",d[i]);t.trigger("gpad:connected",d[i]);n.gamepads[r]={axes:[],buttons:[],timestamp:d[i].timestamp,id:d[i].id};a=n.gamepads[r];for(o=0;o<d[i].buttons.length;o++){a.buttons[o]={value:0,pressed:false}}for(o=0;o<d[i].axes.length;o++){
a.axes[o]=0}continue}else{if(a.timestamp==d[i].timestamp){continue}s=JSON.parse(JSON.stringify(a));a.timestamp=d[i].timestamp;a.axes=d[i].axes.slice(0);for(o=0;o<s.buttons.length;o++){a.buttons[o].pressed=d[i].buttons[o].pressed;a.buttons[o].value=d[i].buttons[o].value}}if(p){for(o=0;o<a.buttons.length;o++){l="up";if(a.buttons[o].pressed){l="down"}c="gpad:button:"+o;if(l=="down"){if(!t.isDown(c)){t._addDown(c)}}else{if(t.isDown(c)){t._handleSeqEvents();t._removeDown(c)}}if(a.buttons[o].pressed!=s.buttons[o].pressed){t.trigger(t.scope+c,a.buttons[o].value,d[i]);t.trigger(t.scope+"gpad:button:"+l,a.buttons[o].value,d[i]);t.trigger(t.scope+c+":"+l,a.buttons[o].value,d[i]);u=true}else if(a.buttons[o].value!=s.buttons[o].value){t.trigger(t.scope+c,a.buttons[o].value,d[i])}}for(o=0;o<s.axes.length;o++){if(a.axes[o]!=s.axes[o]){c="gpad:axis:"+o;t.trigger(t.scope+c,a.axes[o],d[i])}}if(u){t._handleDownEvents(d[i])}}}}};n.loadController=function(e){for(var n in e){t.aliases[n]=e[n]}};return n};t.prototype.init=function(e){var t=this;t.stopGamepadUpdates=function(){clearInterval(t._gamepadTimer)};t.startGamepadUpdates=function(){clearInterval(t._gamepadTimer);if(t.gamepads.length){t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadInterval)}else{t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadCheckInterval)}};t.log=new e.logger(e.settings.logLevel||"INFO","[HI Gamepad]");t.log.debug(e.l("Initializing Gamepad Plugin"),t);e.settings.gpadInterval=e.settings.gpadInterval||100;e.settings.gpadCheckInterval=e.settings.gpadCheckInterval||3e3;clearInterval(t._gamepadTimer);if(e.settings.listenEvents.indexOf("gamepad")!=-1){t.gamepadUpdate();t.startGamepadUpdates();e.on("document:hidden",t.stopGamepadUpdates);e.on("document:visibile",t.startGamepadUpdates);e.on("gpad:connected",t.startGamepadUpdates)}t.exports.gamepads=t.gamepads;t.exports._gamepadTimer=t._gamepadTimer;t.exports.gamepadUpdate=t.gamepadUpdate;t.exports.loadController=t.loadController;t.exports.stopGamepadUpdates=t.stopGamepadUpdates;t.exports.startGamepadUpdates=t.startGamepadUpdates;return t};HumanInput.plugins.push(t)}).call(this);(function(){"use strict";HumanInput.defaultListenEvents.push("speech");var e=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition;var t=function(e){var t=this;t.__name__="SpeechRecPlugin";t.exports={};t._rtSpeech=[];t._rtSpeechPop=function(){t._rtSpeech.reverse();t._rtSpeech.pop();t._rtSpeech.reverse()};t._rtSpeechTimer=null;t.startSpeechRec=function(){t._recognition=new webkitSpeechRecognition;t.log.debug(e.l("Starting speech recognition"),t._recognition);t._recognition.lang=e.settings.speechLang||navigator.language||"en-US";t._recognition.continuous=true;t._recognition.interimResults=true;t._recognition.onresult=function(n){var i,o="speech",r;for(i=n.resultIndex;i<n.results.length;++i){r=n.results[i][0].transcript.trim();if(n.results[i].isFinal){e._addDown(o);e._handleDownEvents(n,r);e._removeDown(o);o+=':"'+r.replace(/-/g,"–")+'"';e._addDown(o);e._handleDownEvents(n,r);e._handleSeqEvents();e._removeDown(o)}else{o+=":rt";e._addDown(o);e._handleDownEvents(n,r);e._removeDown(o);o+=':"'+r.replace(/-/g,"–")+'"';if(t._rtSpeech.indexOf(o)==-1){t._rtSpeech.push(o);e._addDown(o);e._handleDownEvents(n,r);e._removeDown(o)}}}};t._started=true;t._recognition.start()};t.stopSpeechRec=function(){t.log.debug(e.l("Stopping speech recognition"));t._recognition.stop();t._started=false};return t};t.prototype.init=function(t){var n=this;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Speech]");n.log.debug(t.l("Initializing Speech Recognition Plugin"),n);t.settings.autostartSpeech=t.settings.autostartSpeech||false;if(t.settings.listenEvents.indexOf("speech")!=-1){if(e){if(t.settings.autostartSpeech){n.startSpeechRec()}t.on("document:hidden",function(){if(n._started){n.stopSpeechRec()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartSpeech){n.startSpeechRec()}})}else{n.startSpeechRec=t.noop;n.stopSpeechRec=t.noop}}n.exports.startSpeechRec=n.startSpeechRec;n.exports.stopSpeechRec=n.stopSpeechRec;return n};HumanInput.plugins.push(t)}).call(this);(function(){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;HumanInput.defaultListenEvents.push("clapper");var e=window.AudioContext||window.webkitAudioContext,t=60,n=50,i=function(e){return e.reduce(function(e,t){return e+t})},o=function(e){var t=[];for(var n=1;n<e.length-1;++n){if(e[n-1]<e[n]&&e[n]>e[n+1]){t.push(n)}}return t},r=function(r){var s=this;s.__name__="ClapperPlugin";s.exports={};s.history=[];s.rollingAvg=[];s.calcHistoryAverage=function(){var e,t,n=0;for(e=0;e<s.analyser.frequencyBinCount;e++){if(s.history[e]){for(t=0;t<s.history.length;t++){n+=s.history[t][e]}s.rollingAvg[e]=n/s.history.length;n=0}}};s.startClapper=function(){var a=function(e){var a,l,c;s.stream=e;s.scriptProcessor.connect(s.context.destination);s.analyser.smoothingTimeConstant=.4;s.analyser.fftSize=128;s.streamSource=s.context.createMediaStreamSource(e);s.streamSource.connect(s.analyser);s.analyser.connect(s.scriptProcessor);s.scriptProcessor.onaudioprocess=function(){var e,u,f,p,d,g,h,m,v,_,w=Date.now();if(!a){a=w;l=w}e=w-a;u=w-l;f=w-c;if(e>t){s.freqData=new Uint8Array(s.analyser.frequencyBinCount);s.analyser.getByteFrequencyData(s.freqData);d=o(s.freqData);h=s.freqData.indexOf(Math.max.apply(null,s.freqData));g=s.freqData[h];m=s.freqData[h]-s.rollingAvg[h];if(u>=t*4){if(h<8&&m>r.settings.clapThreshold){v=i(s.freqData.slice(0,10))/i(s.freqData.slice(10,20));_=i(s.freqData.slice(0,3))/i(s.freqData.slice(3,6));if(v<1.8&&_<1.4&&d.length>2){p="clap";if(u<t*8){p="doubleclap";c=w;if(f<t*12){p="applause"}}r._addDown(p);r._handleDownEvents();r._handleSeqEvents();r._removeDown(p);l=w}}}a=w;if(l!=w){s.history.push(s.freqData);if(s.history.length>n){s.history.shift()}s.calcHistoryAverage()}}}};s.context=new e;s.scriptProcessor=s.context.createScriptProcessor(1024,1,1);s.analyser=s.context.createAnalyser();s.freqData=new Uint8Array(s.analyser.frequencyBinCount);s.log.debug(r.l("Starting clap detection"));s._started=true;navigator.getUserMedia({audio:true},a,function(e){s.log.error(r.l("Could not get audio stream"),e)})};s.stopClapper=function(){s.log.debug(r.l("Stopping clap detection"));s.stream.getAudioTracks().forEach(function(e){e.stop()});s.stream.getVideoTracks().forEach(function(e){e.stop()});s.streamSource.disconnect(s.analyser);s.analyser.disconnect(s.scriptProcessor);s.scriptProcessor.disconnect(s.context.destination);s._started=false};return s};r.prototype.init=function(t){var n=this;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Clapper]");n.log.debug(t.l("Initializing Clapper Plugin"),n);t.settings.autostartClapper=t.settings.autostartClapper||false;t.settings.clapThreshold=t.settings.clapThreshold||130;t.settings.autotoggleClapper=t.settings.autotoggleClapper||true;if(t.settings.listenEvents.indexOf("clapper")!=-1){if(e){if(t.settings.autostartClapper){n.startClapper()}if(t.settings.autotoggleClapper){t.on("document:hidden",function(){if(n._started){n.stopClapper()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartClapper){n.startClapper()}})}}else{n.startClapper=t.noop;n.stopClapper=t.noop}}n.exports.startClapper=n.startClapper;n.exports.stopClapper=n.stopClapper;return n};HumanInput.plugins.push(r)}).call(this);
