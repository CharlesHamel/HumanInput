(function(){"use strict";var e=this,t,n=navigator.userAgent.indexOf("Mac OS X")!=-1,i=false,o=["keydown","keypress","keyup","click","dblclick","wheel","contextmenu","compositionstart","compositionupdate","compositionend","cut","copy","paste","select"],r=["pointerdown","pointerup"],s=["mousedown","mouseup","touchstart","touchend"],a=false,l=[],f=function(e){return e},u=Object.prototype.toString,c=function(e){if(typeof e==="string"){var t=document.querySelector(e);return t}return e},p=function(e){if(_.isString(e)){e=[e]}return e},g=function(e,t){if(t.indexOf(false)!=-1){e.preventDefault()}},d=function(e){var t,n;if(_.isArray(e)){t=e.slice(0);for(n=0;n<t.length;n++){t[n]=d(t[n])}return t}else{return e}},h=function(e,t){var n=[],i,o,r;if(e.length==1){return e[0]}else{i=h(e.slice(1),t);for(o=0;o<i.length;o++){for(r=0;r<e[0].length;r++){n.push(e[0][r]+t+i[o])}}return n}},m=function(e,t){return/touch/.test(e.type)?(e.originalEvent||e).changedTouches[0]["page"+t]:e["page"+t]},v=function(e){if(e==e.toUpperCase()){return true}},w=function(e,t){return t!=null&&e!=null&&t.indexOf(e)==0},_=_||f;["Function","String","Number"].forEach(function(e){_["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}});_.isArray=Array.isArray;_.toArray=function(e){var t,n=[];for(t=e.length>>>0;t--;){n[t]=e[t]}return n};_.partial=function(e){var t=_.toArray(arguments);t.shift();return function(){return e.apply(this,t.concat(_.toArray(arguments)))}};if(Object.keys(KeyboardEvent.prototype).indexOf("key")!=-1){i=true}var S=function(n,r){if(!(this instanceof S)){return new S(n,r)}var s=this,u,y,b,E,O,x=0;s.__version__="1.0.0";s.OSKEYS=["OS","OSLeft","OSRight"],s.CONTROLKEYS=["Control","ControlLeft","ControlRight"],s.ALTKEYS=["Alt","AltLeft","AltRight"],s.SHIFTKEYS=["Shift","ShiftLeft","ShiftRight","⇧"],s.ALLMODIFIERS=s.OSKEYS.concat(s.CONTROLKEYS,s.ALTKEYS,s.SHIFTKEYS),s.ControlKeyEvent="ctrl";s.ShiftKeyEvent="shift";s.AltKeyEvent="alt";s.OSKeyEvent="os";s.AltAltNames=["option","⌥"];s.AltOSNames=["meta","win","⌘","cmd","command"];r=r||{};s.l=t=r.translate||f;r.listenEvents=r.listenEvents||o;r.noKeyRepeat=r.noKeyRepeat||true;r.sequenceTimeout=r.sequenceTimeout||3e3;r.maxSequenceBuf=r.maxSequenceBuf||12;r.uniqueNumpad=r.uniqueNumpad||false;r.swipeThreshold=r.swipeThreshold||100;s.settings=r;s.elem=c(n||e);s.log=new s.logger(r.logLevel||"INFO","[HI]");s._resetKeyStates=function(){s.modifiers={};s.seqBuffer=[];s.down=[];l=[];x=0;a=false};s._addDown=function(e,t){var n=s.down.indexOf(e);if(n==-1){n=l.indexOf(e)}if(n==-1&&t){n=l.indexOf(t)}if(n==-1){s.down.push(e);if(t){l.push(t)}else{l.push(e)}}};s._removeDown=function(e){var t=s.down.indexOf(e);if(t==-1){t=l.indexOf(e)}if(t==-1){t=l.indexOf(e.toUpperCase())}if(t!=-1){s.down.splice(t,1);l.splice(t,1)}x=s.down.length};s._resetSeqTimeout=function(){clearTimeout(s.temp.seqTimer);s.temp.seqTimer=setTimeout(function(){s.log.debug(t("Resetting key states due to timeout"));s._resetKeyStates()},s.settings.sequenceTimeout)};s._keyEvent=function(e){if(s.CONTROLKEYS.indexOf(e)!=-1){return s.ControlKeyEvent}else if(s.ALTKEYS.indexOf(e)!=-1){return s.AltKeyEvent}else if(s.SHIFTKEYS.indexOf(e)!=-1){return s.ShiftKeyEvent}else if(s.OSKEYS.indexOf(e)!=-1){return s.OSKeyEvent}else{return e.toLowerCase()}};s._seqCombinations=function(e,t){t=t||"-";var n=d(e),i=[],o=[],r,a;for(r=0;r<e.length;r++){i.push(n[r].join(t).toLowerCase())}i=[i.join(" ")];for(r=0;r<e.length;r++){for(a=0;a<e[r].length;a++){n[r][a]=[s._keyEvent(e[r][a])]}}for(r=0;r<n.length;r++){o.push(h(n[r],t))}o=o.join(" ");if(o!=i[0]){i.push(o)}return i};s._downEvents=function(){var e,t=[],n,i=-1,o,r=s.down.slice(0),a=l.slice(0);if(r.length){if(r.length>1){if(s.modifiers.shift){for(e=0;e<r.length;e++){i=r[e].indexOf("Shift");if(i!=-1){break}}}for(e=0;e<r.length;e++){if(r[e]!=l[e]&&i!=-1){o=true}}if(o){if(r.length==2){n=true}r.splice(i,1)}if(!n){t=t.concat(s._seqCombinations([r],"->"));if(o){t=t.concat(s._seqCombinations([a],"->"))}}}s._sortEvents(r);t=t.concat(s._seqCombinations([r]));if(o){s._sortEvents(a);t=t.concat(s._seqCombinations([a]))}}return t};s._handleDownEvents=function(){var e,t=[],n=[],i=_.toArray(arguments);t=s._downEvents();for(e=0;e<t.length;e++){n=n.concat(s.trigger.apply(s,[s.scope+t[e]].concat(i)))}return n};s._handleSeqEvents=function(){var e,t,n,i="",o=s.down.slice(0);if(x<o.length){o=s._sortEvents(o);s.seqBuffer.push(o);if(s.seqBuffer.length>s.settings.maxSequenceBuf){s.seqBuffer.reverse();s.seqBuffer.pop();s.seqBuffer.reverse()}for(t=0;t<s.seqBuffer.length;t++){s.seqBuffer[t].sort(function(e,t){return t.length-e.length})}if(s.seqBuffer.length>1){e=s._seqCombinations(s.seqBuffer);e.forEach(function(e){i+=s.scope+s._seqSlicer(e)+","});i=i.slice(0,-1);n=s.trigger(i,s);if(n.length){s.seqBuffer=[]}}}s._resetSeqTimeout()};s._normSpecial=function(e,t,n){if(n.indexOf("Left")!=-1||n.indexOf("Right")!=-1){t=n}else if(s.settings.uniqueNumpad&&e==3){return"numpad"+t}if(w("arrow",t.toLowerCase())){t=t.substr(5)}return t};s._setModifiers=function(e,t){if(s.ALLMODIFIERS.indexOf(e)){if(s.SHIFTKEYS.indexOf(e)!=-1){s.modifiers.shift=t}if(s.CONTROLKEYS.indexOf(e)!=-1){s.modifiers.ctrl=t}if(s.ALTKEYS.indexOf(e)!=-1){s.modifiers.alt=t;s.modifiers.option=t;s.modifiers["⌥"]=t}if(s.OSKEYS.indexOf(e)!=-1){s.modifiers.meta=t;s.modifiers.command=t;s.modifiers.os=t;s.modifiers["⌘"]=t}s.modifiers[e]=t}};s._keydown=function(e){var t=[],n=e.which||e.keyCode,o=e.location||0,r=s.keyMaps[o][n]||s.keyMaps[0][n]||e.code,a=e.key||r,f=s.filter(e);a=s._normSpecial(o,a,r);s._setModifiers(a,true);if(a=="Compose"){E=true;return}if(l.indexOf(a)==-1){s._addDown(a,r)}s._resetSeqTimeout();if(f){if(e.repeat&&s.settings.noKeyRepeat){e.preventDefault();return false}t=s.trigger(s.scope+"keydown",e,a,r);g(e,t);if(s.down.length>5){t=t.concat(s.trigger(s.scope+"faceplant",e))}t=t.concat(s.trigger(s.scope+"keydown:"+a.toLowerCase(),e,a,r));if(i){t=t.concat(s._handleDownEvents(e))}g(e,t)}};s._keypress=function(e){s.log.debug("_keypress()",e);var t=e.charCode||e.which;var n=e.key||String.fromCharCode(t);if(!i&&t>47&&n.length){s.down.pop();s.down.push(n)}};s._keyup=function(e){var t,n=e.which||e.keyCode,o=e.location||0,r=s.keyMaps[o][n]||s.keyMaps[0][n]||e.code,a=e.key||r,f=s.filter(e);a=s._normSpecial(o,a,r);s.log.debug("_keyup()",e,"self.down:",s.down,"seqBuffer:",s.seqBuffer);if(!l.length){return}if(E){E=false;return}if(f){if(!i){s._handleDownEvents(e)}t=s.trigger(s.scope+"keyup",e,a,r);t=t.concat(s.trigger(s.scope+"keyup:"+a.toLowerCase(),e));s._handleSeqEvents();g(e,t)}s._removeDown(a);s._setModifiers(r,false)};s._pointerdown=function(e){var t,n,i=s.mouse(e),o=[],r=e.changedTouches,a=e.pointerType,l="pointer",f=":down",c=s.filter(e);s.log.debug("_pointerdown() event: "+e.type,e,i,"downEvent:",s.temp._downEvent);if(e.type=="mousedown"&&O){return}if(a){if(a=="touch"){n=e.pointerId;if(!s.touches[n]){s.touches[n]=e}}}else if(r&&r.length){for(t=0;t<r.length;t++){n=r[t].identifier;if(!s.touches[n]){s.touches[n]=r[t]}}}u=m(e,"X");y=m(e,"Y");s._resetSeqTimeout();if(c){o=s.trigger(s.scope+l+f,e);if(i.buttonName!==undefined){l+=":"+i.buttonName;o=o.concat(s.trigger(s.scope+l+f,e));if(e.type=="mousedown"){o=o.concat(s.trigger(s.scope+"mouse:"+i.buttonName+f,e))}}if(e.type=="touchstart"){o=o.concat(s.trigger(s.scope+"touch"+f,e))}g(e,o)}s._addDown(l);s._handleDownEvents(e)};s._mousedown=s._pointerdown;s._touchstart=s._pointerdown;s._pointerup=function(e){var t,n,i,o,r,a,l,f=e.changedTouches,c=e.pointerType,p=s.settings.swipeThreshold,d=[],h=":up",v="pointer";s.log.debug("_pointerup() event: "+e.type,e,i,"seqBuffer:",s.seqBuffer);if(c){if(c=="touch"){n=e.pointerId;if(s.touches[n]){u=s.touches[n].pageX;y=s.touches[n].pageY;r=e.pageX-u;a=e.pageY-y;delete s.touches[n]}}}else if(f){if(f.length){for(t=0;t<f.length;t++){n=f[t].identifier;if(s.touches[n]){u=s.touches[n].pageX;y=s.touches[n].pageY;r=e.pageX-u;a=e.pageY-y;delete s.touches[n]}}}if(Math.abs(e.pageX-u)<20&&Math.abs(e.pageY-y)<20){O=true}if(e.pageX==u&&e.pageY==y){o=true}}if(O&&e.type=="mouseup"){O=false;return}s._resetSeqTimeout();if(s.filter(e)){d=s.trigger(s.scope+v+h,e);i=s.mouse(e);if(i.buttonName!==undefined){v+=":"+i.buttonName;d=d.concat(s.trigger(s.scope+v+h,e));d=d.concat(s.trigger(s.scope+"mouse:"+i.buttonName+h,e))}else if(e.type=="touchend"){d=d.concat(s.trigger(s.scope+"touch"+h,e))}r=u-m(e,"X");a=y-m(e,"Y");l="swipe";if(Math.abs(r)>Math.abs(a)){if(r>p){l+=":left"}else if(r<-p){l+=":right"}}else{if(a>p){l+=":up"}else if(a<-p){l+=":down"}}if(l!="swipe"){s._removeDown(v);HI._addDown(l);d=d.concat(HI._handleDownEvents(e));HI._handleSeqEvents();HI._removeDown(l)}else{s._handleSeqEvents();s._removeDown(v);if(o){d=d.concat(s.trigger(s.scope+"click",e))}g(e,d)}}u=null;y=null};s._mouseup=s._pointerup;s._touchend=s._pointerup;s._pointercancel=function(e){};s._click=function(e){var t,n=s.mouse(e),i="click",o=s.filter(e);s.log.debug("_click()",e,n);s._resetSeqTimeout();if(o){if(n.left){t=s.trigger(s.scope+i,e)}t=s.trigger(s.scope+i+":"+n.buttonName,e);g(e,t)}};s._tap=s._click;s._dblclick=function(e){var t,n=s.mouse(e),i="dblclick",o=s.filter(e);s.log.debug("_dblclick()",e,n);s._resetSeqTimeout();if(o){if(n.left){t=s.trigger(s.scope+i,e)}t=s.trigger(s.scope+i+":"+n.buttonName,e);g(e,t)}};s._wheel=function(e){var t,n=s.mouse(e),i=s.filter(e),o="wheel";s.log.debug("_wheel()",e,n);s._resetSeqTimeout();if(i){t=s.trigger(s.scope+o,e);if(n.wheelY>0){o+=":down"}else if(n.wheelY<0){o+=":up"}else if(n.wheelX>0){o+=":right"}else if(n.wheelX<0){o+=":left"}s._addDown(o);t=t.concat(s._handleDownEvents(e));g(e,t);s._handleSeqEvents();s._removeDown(o)}};s._contextmenu=function(e){var t,n=s.filter(e),i="contextmenu";s.log.debug("_contextmenu()",e);s._resetSeqTimeout();if(n){t=s.trigger(s.scope+i,e)}g(e,t)};s._composition=function(e){var t,n=s.filter(e),i=e.data,o="compos";s.log.debug("_composition() ("+e.type+")",e);if(n){t=s.trigger(s.scope+e.type,e,i);if(i){if(e.type=="compositionupdate"){o+='ing:"'+i+'"'}else if(e.type=="compositionend"){o+='ed:"'+i+'"'}t=t.concat(s.trigger(s.scope+o,e));g(e,t)}}};s._compositionstart=s._composition;s._compositionupdate=s._composition;s._compositionend=s._composition;s._clipboard=function(t){var n,i,o=s.filter(t),r=t.type+':"';s.log.debug("_clipboard() ("+t.type+")",t);if(o){if(e.clipboardData){n=e.clipboardData.getData("Text")}else if(t.clipboardData){n=t.clipboardData.getData("text/plain")}if(!n&&(t.type=="copy"||t.type=="cut")){n=s.getSelText()}if(n){i=s.trigger(s.scope+t.type,t,n);i=i.concat(s.trigger(s.scope+r+n+'"',t));g(t,i)}}};s._paste=s._clipboard;s._copy=s._clipboard;s._cut=s._clipboard;s._select=function(e){var t,n=s.getSelText(),i=e.type+':"';s.log.debug("_select()",e,n);t=s.trigger(s.scope+e.type,e,n);if(n){t=t.concat(s.trigger(s.scope+i+n+'"',e,n));g(e,t)}};s.filter=function(e){var t=(e.target||e.srcElement).tagName,n=["keydown","keyup","keypress"];if(n.indexOf(e.type)!=-1){return!(t=="INPUT"||t=="SELECT"||t=="TEXTAREA")}return true};s.startRecording=function(){s.recording=true;b=[]};s.stopRecording=function(){s.recording=false;return b.reduce(function(e,t){if(e.indexOf(t)<0){e.push(t)}return e},[])};s.isDown=function(e){var t,n,i,o=s._downEvents();e=e.toLowerCase();if(o.indexOf(e)!=-1){return true}for(t=0;t<s.down.length;t++){n=s.down[t].toLowerCase();i=l[t].toLowerCase();if(e==n||e==i){return true}else if(s.SHIFTKEYS.indexOf(s.down[t])!=-1){if(e==s.ShiftKeyEvent){return true}}else if(s.CONTROLKEYS.indexOf(s.down[t])!=-1){if(e==s.ControlKeyEvent){return true}}else if(s.ALTKEYS.indexOf(s.down[t])!=-1){if(e==s.AltKeyEvent){return true}}else if(s.OSKEYS.indexOf(s.down[t])!=-1){if(e==s.OSKeyEvent){return true}}}return false};s.getSelText=function(){var t="";if(e.getSelection){t=e.getSelection()}else if(document.getSelection){t=document.getSelection()}else if(document.selection){t=document.selection.createRange().text}else{return}return t.toString()};s.on=function(e,t,n,i){p(e).forEach(function(e){e=s.aliases[e]||e;if(e.length==1&&v(e)){e="shift-"+e}e=e.toLowerCase();if(e.indexOf("-")!=-1){if(e.indexOf("->")==-1){e=s._normCombo(e)}}var o=s.events[e],r={callback:t,context:n,times:i};if(!o){o=s.events[e]=[]}o.push(r)});return s};s.once=function(e,t,n){return s.on(e,t,n,1)};s.off=function(e,t,n){var i,o;if(!arguments.length){s.events={}}else{e=e?p(e):Object.keys(s.events);for(i in e){var r=e[i],a=s.events[r];if(a){var l=[];for(var o in a){if(t){if(a[o].callback.toString()==t.toString()){if(n&&a[o].context!=n){l.push(a[o])}else if(n===null&&a[o].context){l.push(a[o])}}else{l.push(a[o])}}else if(n&&a[o].context!=n){l.push(a[o])}}if(!l.length){delete s.events[r]}else{s.events[r]=l}}}}return s};s.trigger=function(e){var t,n,i,o,r,a=[],l=[];e=p(e);Array.prototype.push.apply(l,arguments);l.shift();for(t=0;t<e.length;t++){i=s.aliases[e[t]]||e[t];s.log.debug("Triggering:",i,l);if(s.recording){b.push(i)}o=s.events[i];if(o){for(n=0;n<o.length;n++){r=o[n];if(r.times){r.times-=1;if(r.times==0){s.off(i,r.callback,r.context)}}a.push(r.callback.apply(r.context||this,l))}}}return a};s.emit=s.trigger;if(typeof document.hidden!=="undefined"){document.addEventListener("visibilitychange",function(e){if(document.hidden){s.trigger("document:hidden",e)}else{s.trigger("document:visible",e)}},false)}e.addEventListener("resize",function(e){s.trigger("window:resize",e)},false);if(e.orientation!==undefined){e.addEventListener("orientationchange",function(t){s.trigger("window:orientation",t);if(Math.abs(e.orientation)===90){s.trigger("window:orientation:landscape",t)}else{s.trigger("window:orientation:portrait",t)}},false)}s.init(s)};S.plugins=[];if(e.PointerEvent){S.defaultListenEvents=o.concat(r)}else{S.defaultListenEvents=o.concat(s)}S.prototype.init=function(e){var i,o,r,s;e.scope="";e.down=[];e.modifiers={};e.seqBuffer=[];e.m_buttons={};e.touches={};e.temp={};e.aliases={tap:"click",middleclick:"pointer:middle:click",rightclick:"pointer:right:click",doubleclick:"dblclick",tripleclick:Array(4).join("pointer:left ").trim(),quadrupleclick:Array(5).join("pointer:left ").trim(),konami:"up up down down left right left right b a enter",portrait:"window:orientation:portrait",landscape:"window:orientation:landscape",hulksmash:"faceplant"};e.events={};a=false;l=[];e.temp.seqTimer=null;e.off("hi:pause");e.on("hi:pause",function(){var n=e.settings.listenEvents;e.log.debug(t("Pause: Removing event listeners"));n.forEach(function(t){if(_.isFunction(e["_"+t])){e.elem.removeEventListener(t,e["_"+t],true)}})});e.off(["hi:initialized","hi:resume"]);e.on(["hi:initialized","hi:resume"],function(){var n=e.settings.listenEvents;e.log.debug(t("Start/Resume: Addding event listeners"));n.forEach(function(t){if(_.isFunction(e["_"+t])){e.elem.removeEventListener(t,e["_"+t],true);e.elem.addEventListener(t,e["_"+t],true)}})});e.keyMaps={0:{Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,Left:37,ArrowUp:38,Up:38,ArrowRight:39,Right:39,ArrowDown:40,Down:40,PrintScreen:42,Insert:45,Delete:46,Semicolon:59,"=":61,OS:92,Select:93,NumLock:144,ScrollLock:145,VolumeDown:174,VolumeUp:175,MediaTrackPrevious:177,MediaPlayPause:179,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,AltGraph:225,Compose:229},1:{ShiftLeft:16,ControlLeft:17,AltLeft:18,OSLeft:91},2:{ShiftRight:16,ControlRight:17,AltRight:18,OSRight:92}};if(e.settings.uniqueNumpad){e.keyMaps[3]={NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:46,Slash:111}}else{e.keyMaps[3]={"*":106,"+":107,"-":109,".":46,"/":111}}for(i=48;i<=57;i++){e.keyMaps[0][i]=""+(i-48)}for(i=65;i<=90;i++){e.keyMaps[0][i]=String.fromCharCode(i)}for(i=96;i<=105;i++){e.keyMaps[3][i]="Numpad"+(i-96)}for(i=112;i<=123;i++){e.keyMaps[0][i]="F"+(i-112+1)}if(n){e.keyMaps[0]={3:"Enter",63289:"NumpadClear",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"ArrowLeft",63232:"ArrowUp",63235:"ArrowRight",63233:"ArrowDown",63302:"Insert",63272:"Delete"};for(i=63236;i<=63242;i++){e.keyMaps[0][i]="F"+(i-63236+1)}}for(i=0;i<=3;i++){Object.keys(e.keyMaps[i]).forEach(function(t){if(t.length>1&&!isNaN(t)){t=parseInt(t)}e.keyMaps[i][e.keyMaps[i][t]]=t})}if(S.plugins.length){for(i=0;i<S.plugins.length;i++){o=new S.plugins[i](e);e.log.debug(t("Initializing Plugin:"),o.__name__);if(_.isFunction(o.init)){r=o.init(e);for(s in r.exports){e[s]=r.exports[s]}}}}e.trigger("hi:initialized",e)};S.prototype.logger=function(t,n){var i=this,o=function(){var t=_.toArray(arguments);t[0]=n+i.levels[level]+": "+t[0];if(_.isFunction(e.console.log)){e.console.log.apply(e.console,t)}},r=function(t){var r=Array.prototype.slice.call(arguments,1);if(n.length){r.unshift(n)}if(t==40&&i.logLevel<=40){if(_.isFunction(e.console.error)){e.console.error.apply(e.console,r)}else{o.apply(i,r)}}else if(t==30&&i.logLevel<=30){if(_.isFunction(e.console.warn)){e.console.warn.apply(e.console,r)}else{o.apply(i,r)}}else if(t==20&&i.logLevel<=20){if(_.isFunction(e.console.info)){e.console.info.apply(e.console,r)}else{o.apply(i,r)}}else if(t==10&&i.logLevel<=10){if(_.isFunction(e.console.debug)){e.console.debug.apply(e.console,r)}else{o.apply(i,r)}}};n=n||"";if(n.length){n+=":"}i.levels={40:"ERROR",30:"WARNING",20:"INFO",10:"DEBUG",ERROR:40,WARNING:30,INFO:20,DEBUG:10};i.setLevel=function(e){e=e.toUpperCase();i.error=_.partial(r,40);i.warn=_.partial(r,30);i.info=_.partial(r,20);i.debug=_.partial(r,10);i.logLevel=e;if(isNaN(e)){i.logLevel=e=i.levels[e]}if(e>40){i.error=f}if(e>30){i.warn=f}if(e>20){i.info=f}if(e>10){i.debug=f}};i.setLevel(t)};S.prototype.pushScope=function(e){if(this.scope.length){this.scope=this.scope.slice(0,-1)+"."+e+":"}else{this.scope=e+":"}};S.prototype.popScope=function(){if(this.scope.length){this.scope=this.scope.slice(0,-1).split(".").slice(0,-1).join(".")+":"}if(this.scope==":"){this.scope=""}};S.prototype.pause=function(){this.paused=true;this.trigger("hi:pause",this)};S.prototype.resume=function(){this.paused=false;this.trigger("hi:resume",this)};S.prototype._seqSlicer=function(e){var t=[],n,i,o;e=e.split(/ +(?=(?:(?:[^"]*"){2})*[^"]*$)/g);for(n=0;n<e.length-1;n++){i=e.slice(n);o=i.join(" ");if(t.indexOf(o)==-1){t.push(o)}}return t};S.prototype._sortEvents=function(e){var t,n=this,i=n.CONTROLKEYS.concat(["ctrl"]),o=n.ALTKEYS.concat(n.AltAltNames),r=n.OSKEYS.concat(n.AltOSNames),s={};for(t=0;t<i.length;t++){s[i[t].toLowerCase()]=5}for(t=0;t<n.SHIFTKEYS.length;t++){s[n.SHIFTKEYS[t].toLowerCase()]=4}for(t=0;t<o.length;t++){s[o[t].toLowerCase()]=3}for(t=0;t<r.length;t++){s[r[t].toLowerCase()]=2}e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});e.sort(function(e,t){return t.length-e.length});e.sort(function(e,t){e=e.toLowerCase();t=t.toLowerCase();if(e in s){if(t in s){if(s[e]>s[t]){return-1}else if(s[e]<s[t]){return 1}else{return 0}}return-1}else if(t in s){return 1}else{return 0}});return e};S.prototype._normCombo=function(e){var t=this,n,i=e.split("-"),o=i.length,r=function(e){if(e=="control"){return t.ControlKeyEvent}return e},s=function(e){for(var n=0;n<t.AltAltNames.length;n++){if(e==t.AltAltNames[n]){return t.AltKeyEvent}}return e},a=function(e){for(var n=0;n<t.AltOSNames.length;n++){if(e==t.AltOSNames[n]){return t.OSKeyEvent}}return e};for(n=0;n<o;n++){if(i[n]==""){i[n]=="-"}i[n]=i[n].toLowerCase();i[n]=r(i[n]);i[n]=s(i[n]);i[n]=a(i[n])}t._sortEvents(i);return i.join("-")};S.prototype.mouse=function(e){var t={type:e.type};if(e.type!="mousemove"&&e.type!="mousewheel"&&e.type!="wheel"){if(e.button==0){t.left=true;t.buttonName="left"}else if(e.button==1){t.middle=true;t.buttonName="middle"}else if(e.button==2){t.right=true;t.buttonName="right"}else if(e.button==3){t.back=true;t.buttonName="back"}else if(e.button==4){t.forward=true;t.buttonName="forward"}else if(e.button==5){t.forward=true;t.buttonName="eraser"}else{t.buttonName=e.button}}t.button=e.button;if(e.type=="wheel"||e.type=="mousewheel"){if(e.wheelDeltaX||e.wheelDeltaY){t.wheelX=e.wheelDeltaX/-40||0;t.wheelY=e.wheelDeltaY/-40||0}else if(e.wheelDelta){t.wheelY=e.wheelDelta/-40}else{t.wheelY=e.detail||0}}return t};if(typeof module!=="undefined"&&module.exports){module.exports=S}if(typeof define==="function"&&define.amd){define([],function(){return S})}else if(typeof exports!=="undefined"&&exports!==null){exports.HumanInput=S}else{e.HumanInput=S}}).call(this);(function(){"use strict";var e=function(e){var t=this;t.__name__="GamepadPlugin";t.exports={};t.gamepads=[];t._gamepadTimer=null;t.gamepadUpdate=function(){var n,i,o,r,s,a,l,f,u={type:"gamepad",target:e.elem},c=navigator.getGamepads();for(n=0;n<c.length;++n){if(c[n]){o=c[n].index,s=t.gamepads[o];if(!s){t.log.debug("Gamepad "+o+" detected:",c[n]);e.trigger("gpad:connected",c[n]);t.gamepads[o]={axes:[],buttons:[],timestamp:c[n].timestamp,id:c[n].id};s=t.gamepads[o];for(i=0;i<c[n].buttons.length;i++){s.buttons[i]={value:0,pressed:false}}for(i=0;i<c[n].axes.length;i++){s.axes[i]=0}continue}else{if(s.timestamp==c[n].timestamp){continue}r=JSON.parse(JSON.stringify(s));s.timestamp=c[n].timestamp;s.axes=c[n].axes.slice(0);for(i=0;i<r.buttons.length;i++){s.buttons[i].pressed=c[n].buttons[i].pressed;s.buttons[i].value=c[n].buttons[i].value}}for(i=0;i<s.buttons.length;i++){a="up";if(s.buttons[i].pressed){a="down"}l="gpad:button:"+i;if(a=="down"){if(!e.isDown(l)){e._addDown(l)}}else{if(e.isDown(l)){e._handleSeqEvents();e._removeDown(l)}}if(s.buttons[i].pressed!=r.buttons[i].pressed){e.trigger(e.scope+l+":"+a,s.buttons[i].value,c[n]);f=true}if(s.buttons[i].value!=r.buttons[i].value){e.trigger(e.scope+l+":value",s.buttons[i].value,c[n])}}if(e.filter(u)){for(i=0;i<r.axes.length;i++){if(s.axes[i]!=r.axes[i]){l="gpad:axis:"+i;e.trigger(e.scope+l,s.axes[i],c[n])}}if(f){e._handleDownEvents(c[n])}}}}};t.loadController=function(t){for(var n in t){e.aliases[n]=t[n]}};return t};e.prototype.init=function(e){var t=this,n=function(){clearInterval(t._gamepadTimer)},i=function(){clearInterval(t._gamepadTimer);if(t.gamepads.length){t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadInterval)}else{t._gamepadTimer=setInterval(t.gamepadUpdate,e.settings.gpadCheckInterval)}};t.log=new e.logger(e.settings.logLevel||"INFO","[HI Gamepad]");t.log.debug("Initializing Gamepad Plugin",t);e.settings.gpadInterval=e.settings.gpadInterval||100;e.settings.gpadCheckInterval=e.settings.gpadCheckInterval||3e3;clearInterval(t._gamepadTimer);if(e.settings.listenEvents.indexOf("gamepad")!=-1){t.gamepadUpdate();i();e.on("document:hidden",n);e.on("document:visibile",i)}t.exports.gamepads=t.gamepads;t.exports._gamepadTimer=t._gamepadTimer;t.exports.gamepadUpdate=t.gamepadUpdate;t.exports.loadController=t.loadController;return t};HumanInput.plugins.push(e)}).call(this);(function(){"use strict";HumanInput.defaultListenEvents.push("speech");var e=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition;var t=function(e){var t=this;t.__name__="SpeechRecPlugin";t.exports={};t._rtSpeech=[];t._rtSpeechPop=function(){t._rtSpeech.reverse();t._rtSpeech.pop();t._rtSpeech.reverse()};t._rtSpeechTimer=null;t.startSpeechRec=function(){t._recognition=new webkitSpeechRecognition;t.log.debug("Starting speech recognition",t._recognition);t._recognition.lang=e.settings.speechLang||navigator.language||"en-US";t._recognition.continuous=true;t._recognition.interimResults=true;t._recognition.onresult=function(n){var i,o,r;for(i=n.resultIndex;i<n.results.length;++i){r=n.results[i][0].transcript.trim();if(n.results[i].isFinal){o='speech:"'+r.replace(/-/g,"–")+'"';e._addDown(o);e._handleDownEvents(n,r);e._handleSeqEvents();e._removeDown(o)}else{o="speech:rt:"+r.replace(/-/g,"–")+'"';if(t._rtSpeech.indexOf(o)==-1){t._rtSpeech.push(o);e._addDown(o);e._handleDownEvents(n,r);e._removeDown(o)}}}};t._started=true;t._recognition.start()};t.stopSpeechRec=function(){t.log.debug("Stopping speech recognition");t._recognition.stop();t._started=false};return t};t.prototype.init=function(t){var n=this,i=t.l;n.log=new t.logger(t.settings.logLevel||"INFO","[HI Speech]");n.log.debug(i("Initializing Speech Recognition Plugin"),n);t.settings.autostartSpeech=t.settings.autostartSpeech||false;if(t.settings.listenEvents.indexOf("speech")!=-1){if(e){if(t.settings.autostartSpeech){n.startSpeechRec()}t.on("document:hidden",function(){if(n._started){n.stopSpeechRec()}});t.on("document:visible",function(){if(!n._started&&t.settings.autostartSpeech){n.startSpeechRec()}})}else{n.startSpeechRec=t.noop;n.stopSpeechRec=t.noop}}n.exports.startSpeechRec=n.startSpeechRec;n.exports.stopSpeechRec=n.stopSpeechRec;return n};HumanInput.plugins.push(t)}).call(this);
